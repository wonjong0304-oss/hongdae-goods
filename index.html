[í™ëŒ€êµ¿ì¦ˆìƒµ_v7.html](https://github.com/user-attachments/files/24696437/_v7.html)
<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>í™ëŒ€ êµ¿ì¦ˆìƒµ</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ğŸ­</text></svg>">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        :root {
            --bg: #000;
            --card: #1c1c1e;
            --text: #fff;
            --text-sub: #8e8e93;
            --primary: #007aff;
            --success: #30d158;
            --danger: #ff453a;
            --warning: #ff9f0a;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Pretendard', sans-serif;
            background: var(--bg);
            color: var(--text);
            min-height: 100vh;
            line-height: 1.4;
        }

        /* ì¸íŠ¸ë¡œ */
        .intro {
            position: fixed;
            inset: 0;
            background: linear-gradient(180deg, #0a0a1a 0%, #1a1a2e 50%, #000 100%);
            z-index: 300;
            display: flex;
            flex-direction: column;
            padding: 60px 28px 40px;
        }
        .intro.hidden { display: none; }

        .intro-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        .intro-emoji {
            font-size: 72px;
            margin-bottom: 28px;
            animation: float 3s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        .intro-title {
            font-size: 32px;
            font-weight: 800;
            line-height: 1.3;
            margin-bottom: 32px;
        }
        .intro-title .highlight { color: var(--primary); }

        .intro-benefits {
            display: flex;
            flex-direction: column;
            gap: 14px;
            margin-bottom: 40px;
        }

        .benefit-item {
            display: flex;
            align-items: center;
            gap: 14px;
            padding: 16px;
            background: rgba(255,255,255,0.05);
            border-radius: 14px;
            border: 1px solid rgba(255,255,255,0.1);
        }

        .benefit-icon {
            width: 44px;
            height: 44px;
            background: linear-gradient(135deg, var(--primary), #5856d6);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 22px;
        }

        .benefit-text .main { font-size: 16px; font-weight: 700; }
        .benefit-text .sub { font-size: 13px; color: var(--text-sub); }

        .intro-cta {
            width: 100%;
            padding: 18px;
            background: var(--primary);
            border: none;
            border-radius: 16px;
            font-size: 18px;
            font-weight: 700;
            color: #fff;
            cursor: pointer;
            margin-bottom: 12px;
        }

        .intro-skip {
            width: 100%;
            padding: 14px;
            background: var(--card);
            border: none;
            border-radius: 16px;
            font-size: 16px;
            font-weight: 600;
            color: var(--text);
            cursor: pointer;
        }

        .intro-footer {
            text-align: center;
            font-size: 13px;
            color: var(--text-sub);
            margin-top: 16px;
        }

        /* ì˜¨ë³´ë”© */
        .onboarding {
            position: fixed;
            inset: 0;
            background: var(--bg);
            z-index: 200;
            display: none;
            flex-direction: column;
        }
        .onboarding.show { display: flex; }

        .onboarding-header {
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .progress-bar {
            flex: 1;
            height: 4px;
            background: #333;
            border-radius: 2px;
            margin-right: 16px;
        }
        .progress-fill {
            height: 100%;
            background: var(--primary);
            border-radius: 2px;
            transition: width 0.3s;
        }

        .skip-btn {
            font-size: 15px;
            color: var(--text-sub);
            background: none;
            border: none;
            cursor: pointer;
        }

        .onboarding-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            padding: 20px 24px 40px;
        }

        .question-num {
            font-size: 14px;
            color: var(--primary);
            font-weight: 700;
            margin-bottom: 12px;
        }

        .question-text {
            font-size: 26px;
            font-weight: 800;
            margin-bottom: 32px;
        }

        .options {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .option-btn {
            padding: 18px 20px;
            background: var(--card);
            border: 2px solid #333;
            border-radius: 14px;
            font-size: 16px;
            font-weight: 600;
            color: var(--text);
            text-align: left;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 14px;
            transition: all 0.2s;
        }
        .option-btn:active { transform: scale(0.98); }
        .option-btn.selected { border-color: var(--primary); background: rgba(0,122,255,0.15); }

        .option-icon {
            font-size: 28px;
            width: 44px;
            height: 44px;
            background: #333;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .option-btn.selected .option-icon { background: var(--primary); }

        .option-text { flex: 1; }
        .option-text .main { display: block; margin-bottom: 2px; }
        .option-text .sub { font-size: 13px; color: var(--text-sub); font-weight: 400; }

        /* ê²°ê³¼ í™”ë©´ */
        .result-screen {
            position: fixed;
            inset: 0;
            background: var(--bg);
            z-index: 200;
            display: none;
            flex-direction: column;
        }
        .result-screen.show { display: flex; }

        .result-header {
            padding: 16px 20px;
            display: flex;
            align-items: center;
            gap: 12px;
            border-bottom: 1px solid #222;
        }

        .back-btn {
            width: 40px;
            height: 40px;
            background: var(--card);
            border: none;
            border-radius: 12px;
            font-size: 20px;
            cursor: pointer;
            color: var(--text);
        }
        .result-header h1 { font-size: 18px; font-weight: 700; }

        .result-content {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
        }

        .ai-card {
            background: linear-gradient(135deg, #1a1a2e, #16213e);
            border: 1px solid #334;
            border-radius: 20px;
            padding: 24px;
            margin-bottom: 24px;
        }

        .ai-badge {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 6px 12px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            border-radius: 20px;
            font-size: 12px;
            font-weight: 700;
            margin-bottom: 16px;
        }

        .ai-title { font-size: 24px; font-weight: 800; margin-bottom: 8px; }
        .ai-desc { font-size: 15px; color: var(--text-sub); margin-bottom: 20px; }

        .ai-reasons {
            background: rgba(255,255,255,0.05);
            border-radius: 12px;
            padding: 16px;
        }
        .ai-reasons-title { font-size: 13px; font-weight: 700; color: var(--text-sub); margin-bottom: 12px; }
        .reason-item { display: flex; align-items: flex-start; gap: 10px; margin-bottom: 10px; font-size: 14px; }
        .reason-item:last-child { margin-bottom: 0; }
        .reason-icon { width: 20px; height: 20px; background: var(--primary); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 11px; flex-shrink: 0; }

        .section-title {
            font-size: 14px;
            font-weight: 700;
            color: var(--text-sub);
            margin-bottom: 14px;
            display: flex;
            justify-content: space-between;
        }
        .shop-count { color: var(--primary); }

        /* ê°€ê²Œ ì¹´ë“œ */
        .shop-card {
            background: var(--card);
            border-radius: 16px;
            overflow: hidden;
            margin-bottom: 12px;
            cursor: pointer;
        }
        .shop-card:active { transform: scale(0.98); }
        .shop-card.first { border: 1px solid rgba(0,122,255,0.3); }
        .shop-card.visited { opacity: 0.5; }

        .shop-photo {
            width: 100%;
            height: 100px;
            background: linear-gradient(135deg, #2c2c2e 0%, #1c1c1e 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 40px;
            position: relative;
        }

        .shop-status {
            position: absolute;
            top: 10px;
            left: 10px;
            padding: 6px 10px;
            border-radius: 8px;
            font-size: 12px;
            font-weight: 700;
        }
        .shop-status.open { background: var(--success); color: #fff; }
        .shop-status.closed { background: var(--danger); color: #fff; }
        .shop-status.soon { background: var(--warning); color: #000; }

        .shop-rank-badge {
            position: absolute;
            top: 10px;
            right: 10px;
            width: 28px;
            height: 28px;
            background: var(--primary);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            font-weight: 800;
        }

        .shop-visited-badge {
            position: absolute;
            top: 10px;
            right: 10px;
            padding: 6px 10px;
            background: var(--success);
            border-radius: 8px;
            font-size: 12px;
            font-weight: 700;
        }

        .shop-body { padding: 14px; }

        .shop-name-row {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 8px;
        }
        .shop-name { font-size: 17px; font-weight: 700; }

        .shop-meta {
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 13px;
            color: var(--text-sub);
            margin-bottom: 10px;
        }

        .shop-genres {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
        }
        .genre-tag {
            padding: 4px 10px;
            background: #333;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 600;
            color: #a78bfa;
        }

        /* í•˜ë‹¨ ë²„íŠ¼ */
        .result-footer {
            padding: 16px 20px 32px;
            border-top: 1px solid #222;
        }

        .start-btn {
            width: 100%;
            padding: 18px;
            background: var(--primary);
            border: none;
            border-radius: 14px;
            font-size: 17px;
            font-weight: 700;
            color: #fff;
            cursor: pointer;
            margin-bottom: 10px;
        }

        .secondary-btns { display: flex; gap: 10px; }
        .sec-btn {
            flex: 1;
            padding: 14px;
            background: var(--card);
            border: none;
            border-radius: 12px;
            font-size: 14px;
            font-weight: 600;
            color: var(--text);
            cursor: pointer;
        }

        /* ë©”ì¸ ì•± */
        .app {
            display: none;
            flex-direction: column;
            height: 100vh;
        }
        .app.show { display: flex; }

        .current-dest {
            background: var(--card);
            padding: 20px;
            border-bottom: 1px solid #333;
        }

        .dest-label {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 13px;
            color: var(--text-sub);
            margin-bottom: 12px;
        }

        .live-dot {
            width: 8px;
            height: 8px;
            background: var(--success);
            border-radius: 50%;
            animation: blink 1.5s infinite;
        }
        @keyframes blink { 0%, 100% { opacity: 1; } 50% { opacity: 0.3; } }

        .stamps { display: flex; gap: 6px; margin-left: auto; }
        .stamp {
            width: 24px;
            height: 24px;
            background: #333;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 11px;
            font-weight: 700;
        }
        .stamp.done { background: var(--success); }
        .stamp.current { background: var(--primary); animation: pulse 2s infinite; }
        @keyframes pulse {
            0%, 100% { box-shadow: 0 0 0 0 rgba(0,122,255,0.5); }
            50% { box-shadow: 0 0 0 8px rgba(0,122,255,0); }
        }

        .dest-shop {
            display: flex;
            align-items: center;
            gap: 14px;
            margin-bottom: 14px;
        }

        .dest-photo {
            width: 72px;
            height: 72px;
            background: linear-gradient(135deg, #007aff33, #5856d633);
            border: 2px solid var(--primary);
            border-radius: 18px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 36px;
        }

        .dest-info { flex: 1; }
        .dest-info h2 { font-size: 20px; font-weight: 800; margin-bottom: 4px; }
        .dest-info p { font-size: 14px; color: var(--text-sub); }

        .dest-walk {
            padding: 8px 14px;
            background: var(--primary);
            border-radius: 20px;
            font-size: 15px;
            font-weight: 700;
        }

        .dest-status-bar {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            background: #262628;
            border-radius: 12px;
            margin-bottom: 14px;
        }
        .dest-status-bar .status {
            padding: 6px 12px;
            border-radius: 8px;
            font-size: 13px;
            font-weight: 700;
        }
        .dest-status-bar .status.open { background: var(--success); }
        .dest-status-bar .status.closed { background: var(--danger); }
        .dest-status-bar .hours { font-size: 14px; color: var(--text-sub); }

        .dest-genres {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
            margin-bottom: 14px;
        }

        .dest-actions { display: flex; gap: 10px; }
        .action-btn {
            flex: 1;
            padding: 14px;
            border: none;
            border-radius: 12px;
            font-size: 15px;
            font-weight: 700;
            cursor: pointer;
        }
        .action-btn.primary { background: var(--primary); color: #fff; }
        .action-btn.secondary { background: #333; color: #fff; }
        .action-btn.success { background: var(--success); color: #fff; }
        .action-btn.danger { background: var(--danger); color: #fff; }

        /* ì§€ë„ */
        .map-container { flex: 1; position: relative; }
        #map { width: 100%; height: 100%; }

        .map-status {
            position: absolute;
            top: 16px;
            left: 16px;
            right: 16px;
            background: rgba(0,0,0,0.85);
            backdrop-filter: blur(10px);
            border-radius: 14px;
            padding: 14px 18px;
            display: flex;
            align-items: center;
            gap: 12px;
            z-index: 10;
        }
        .map-status-icon {
            width: 44px;
            height: 44px;
            background: var(--primary);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 22px;
        }
        .map-status-text { flex: 1; }
        .map-status-text .title { font-size: 15px; font-weight: 700; }
        .map-status-text .sub { font-size: 13px; color: var(--text-sub); }
        .map-status-badge {
            padding: 6px 10px;
            border-radius: 8px;
            font-size: 12px;
            font-weight: 700;
        }
        .map-status-badge.open { background: var(--success); }
        .map-status-badge.closed { background: var(--danger); }

        .map-btn {
            position: absolute;
            width: 48px;
            height: 48px;
            background: var(--card);
            border: none;
            border-radius: 50%;
            font-size: 22px;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(0,0,0,0.5);
            z-index: 10;
        }
        .loc-btn { bottom: 100px; right: 16px; }
        .list-btn { bottom: 160px; right: 16px; }

        .next-preview {
            position: absolute;
            bottom: 16px;
            left: 16px;
            right: 16px;
            background: var(--card);
            border-radius: 16px;
            padding: 16px;
            display: flex;
            align-items: center;
            gap: 14px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.5);
            z-index: 10;
        }
        .next-icon {
            width: 48px;
            height: 48px;
            background: #333;
            border-radius: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
        }
        .next-info { flex: 1; }
        .next-info .label { font-size: 12px; color: var(--text-sub); font-weight: 600; }
        .next-info h4 { font-size: 16px; font-weight: 700; }
        .next-walk { font-size: 15px; font-weight: 700; color: var(--primary); }

        /* ììœ  íƒë°© ëª¨ë“œ */
        .free-mode-header {
            background: var(--card);
            padding: 16px 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            border-bottom: 1px solid #333;
        }
        .free-mode-header h1 { font-size: 18px; font-weight: 700; }
        .free-mode-header .close-btn {
            width: 36px;
            height: 36px;
            background: #333;
            border: none;
            border-radius: 10px;
            font-size: 18px;
            cursor: pointer;
            color: var(--text);
        }

        .free-mode-stats {
            display: flex;
            gap: 12px;
            padding: 12px 20px;
            background: #111;
        }
        .stat-item {
            padding: 8px 14px;
            background: var(--card);
            border-radius: 10px;
            font-size: 13px;
        }
        .stat-item strong { color: var(--primary); }

        /* ëª¨ë‹¬ */
        .modal-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.7);
            z-index: 100;
            display: none;
            align-items: flex-end;
        }
        .modal-overlay.show { display: flex; }

        .modal {
            background: var(--card);
            border-radius: 24px 24px 0 0;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
        }
        .modal-handle { width: 36px; height: 4px; background: #444; border-radius: 2px; margin: 10px auto; }
        .modal-content { padding: 0 20px 32px; }

        .modal-photo {
            width: 100%;
            height: 140px;
            background: linear-gradient(135deg, #2c2c2e, #1c1c1e);
            border-radius: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 56px;
            margin-bottom: 20px;
            position: relative;
        }
        .modal-status {
            position: absolute;
            bottom: 12px;
            left: 12px;
            padding: 8px 14px;
            border-radius: 10px;
            font-size: 14px;
            font-weight: 700;
        }
        .modal-status.open { background: var(--success); }
        .modal-status.closed { background: var(--danger); }

        .modal-title-row {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 8px;
        }
        .modal-title { font-size: 24px; font-weight: 800; }

        .modal-meta {
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 14px;
            color: var(--text-sub);
            margin-bottom: 16px;
        }

        .modal-genres {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 20px;
        }

        .modal-info {
            background: #262628;
            border-radius: 14px;
            overflow: hidden;
            margin-bottom: 20px;
        }
        .modal-info-row {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 14px 16px;
            border-bottom: 1px solid #333;
            font-size: 15px;
        }
        .modal-info-row:last-child { border-bottom: none; }
        .modal-info-row .icon { font-size: 18px; width: 24px; text-align: center; }

        .modal-actions { display: flex; gap: 10px; }
        .modal-btn {
            flex: 1;
            padding: 16px;
            border: none;
            border-radius: 14px;
            font-size: 16px;
            font-weight: 700;
            cursor: pointer;
        }
        .modal-btn.primary { background: var(--primary); color: #fff; }
        .modal-btn.secondary { background: #333; color: #fff; }
        .modal-btn.success { background: var(--success); color: #fff; }

        /* ì™„ë£Œ í™”ë©´ */
        .complete-screen {
            position: fixed;
            inset: 0;
            background: var(--bg);
            z-index: 150;
            display: none;
            flex-direction: column;
        }
        .complete-screen.show { display: flex; }

        .complete-header {
            padding: 20px;
            text-align: center;
            border-bottom: 1px solid #222;
        }
        .complete-header h2 { font-size: 24px; font-weight: 800; }
        .complete-header p { font-size: 14px; color: var(--text-sub); margin-top: 4px; }

        .complete-content {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
        }

        .complete-shop-card {
            background: var(--card);
            border-radius: 14px;
            padding: 16px;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 14px;
        }
        .complete-shop-icon {
            width: 52px;
            height: 52px;
            background: var(--success);
            border-radius: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 26px;
        }
        .complete-shop-info { flex: 1; }
        .complete-shop-info h3 { font-size: 16px; font-weight: 700; margin-bottom: 4px; }
        .complete-shop-info p { font-size: 13px; color: var(--text-sub); }

        .complete-footer {
            padding: 16px 20px 32px;
            border-top: 1px solid #222;
        }

        .complete-btn {
            width: 100%;
            padding: 16px;
            border: none;
            border-radius: 14px;
            font-size: 16px;
            font-weight: 700;
            cursor: pointer;
            margin-bottom: 10px;
        }
        .complete-btn.primary { background: var(--primary); color: #fff; }
        .complete-btn.secondary { background: #333; color: #fff; }

        .toast {
            position: fixed;
            bottom: 100px;
            left: 50%;
            transform: translateX(-50%);
            background: #333;
            padding: 14px 24px;
            border-radius: 12px;
            font-size: 15px;
            font-weight: 600;
            z-index: 500;
            display: none;
        }
        .toast.show { display: block; }
    </style>
</head>
<body>

<!-- ì¸íŠ¸ë¡œ -->
<div class="intro" id="intro">
    <div class="intro-content">
        <div class="intro-emoji">ğŸ­</div>
        <h1 class="intro-title">
            í™ëŒ€ ë•ì§ˆ,<br>
            <span class="highlight">ì–´ë””ë¶€í„° ê°€ì•¼ í• ì§€</span><br>
            ë§‰ë§‰í–ˆë‹¤ë©´?
        </h1>
        <div class="intro-benefits">
            <div class="benefit-item">
                <div class="benefit-icon">ğŸ¯</div>
                <div class="benefit-text">
                    <div class="main">ë‚´ ì·¨í–¥ ë§ì¶¤ ë£¨íŠ¸</div>
                    <div class="sub">ì•™ìŠ¤íƒ€, ë¸”ë£¨ë¡, í”¼ê·œì–´ ì·¨í–¥ë³„ ì¶”ì²œ</div>
                </div>
            </div>
            <div class="benefit-item">
                <div class="benefit-icon">â°</div>
                <div class="benefit-text">
                    <div class="main">ì˜ì—…ì¤‘ì¸ ê³³ë§Œ</div>
                    <div class="sub">ì§€ê¸ˆ ì—´ë ¤ìˆëŠ” ê°€ê²Œ ì‹¤ì‹œê°„ í™•ì¸</div>
                </div>
            </div>
            <div class="benefit-item">
                <div class="benefit-icon">ğŸ“</div>
                <div class="benefit-text">
                    <div class="main">ë°©ë¬¸ ê¸°ë¡ ì €ì¥</div>
                    <div class="sub">ë‹¤ë…€ì˜¨ ê³³ ì²´í¬í•˜ê³  ìƒˆë¡œìš´ ê³³ ë°œê²¬</div>
                </div>
            </div>
        </div>
    </div>
    <button class="intro-cta" onclick="startOnboarding()">ğŸ¯ ë§ì¶¤ ì½”ìŠ¤ ì¶”ì²œë°›ê¸°</button>
    <button class="intro-skip" onclick="startFreeMode()">ğŸ—º ììœ ë¡­ê²Œ ë‘˜ëŸ¬ë³´ê¸°</button>
    <div class="intro-footer">25ê°œ êµ¿ì¦ˆìƒµ ì •ë³´ ìˆ˜ë¡</div>
</div>

<!-- ì˜¨ë³´ë”© -->
<div class="onboarding" id="onboarding">
    <div class="onboarding-header">
        <div class="progress-bar"><div class="progress-fill" id="progressFill"></div></div>
        <button class="skip-btn" onclick="skipOnboarding()">ê±´ë„ˆë›°ê¸°</button>
    </div>
    <div class="onboarding-content" id="questionContent"></div>
</div>

<!-- ê²°ê³¼ í™”ë©´ -->
<div class="result-screen" id="resultScreen">
    <div class="result-header">
        <button class="back-btn" onclick="backToOnboarding()">â†</button>
        <h1>ë§ì¶¤ ì¶”ì²œ</h1>
    </div>
    <div class="result-content" id="resultContent"></div>
    <div class="result-footer">
        <button class="start-btn" onclick="startTour()">ğŸš€ íƒë°© ì‹œì‘</button>
        <div class="secondary-btns">
            <button class="sec-btn" onclick="backToOnboarding()">ğŸ”„ ë‹¤ì‹œ ì„ íƒ</button>
            <button class="sec-btn" onclick="shareCourse()">ğŸ“¤ ê³µìœ </button>
        </div>
    </div>
</div>

<!-- ë©”ì¸ ì•± (ì½”ìŠ¤ ëª¨ë“œ) -->
<div class="app" id="app">
    <div class="current-dest" id="currentDest"></div>
    <div class="map-container">
        <div id="map"></div>
        <div class="map-status" id="mapStatus"></div>
        <button class="map-btn loc-btn" onclick="goToMyLocation()">ğŸ“</button>
        <div class="next-preview" id="nextPreview"></div>
    </div>
</div>

<!-- ììœ  íƒë°© ëª¨ë“œ -->
<div class="app" id="freeApp">
    <div class="free-mode-header">
        <h1>ğŸ—º ì „ì²´ êµ¿ì¦ˆìƒµ</h1>
        <button class="close-btn" onclick="closeFreeMode()">âœ•</button>
    </div>
    <div class="free-mode-stats" id="freeStats"></div>
    <div class="map-container">
        <div id="freeMap"></div>
        <button class="map-btn loc-btn" onclick="goToMyLocationFree()">ğŸ“</button>
    </div>
</div>

<!-- ëª¨ë‹¬ -->
<div class="modal-overlay" id="modal" onclick="closeModal(event)">
    <div class="modal" onclick="event.stopPropagation()">
        <div class="modal-handle"></div>
        <div class="modal-content" id="modalContent"></div>
    </div>
</div>

<!-- ì™„ë£Œ -->
<div class="complete-screen" id="completeScreen">
    <div class="complete-header">
        <h2>ğŸ‰ íƒë°© ì™„ë£Œ!</h2>
        <p id="completeSubtext">ì˜¤ëŠ˜ ë‹¤ë…€ì˜¨ ê³³ë“¤</p>
    </div>
    <div class="complete-content" id="completeContent"></div>
    <div class="complete-footer">
        <button class="complete-btn primary" onclick="viewAllMap()">ğŸ—º ì „ì²´ ì§€ë„ë¡œ ë³´ê¸°</button>
        <button class="complete-btn secondary" onclick="resetApp()">ğŸ”„ ì²˜ìŒìœ¼ë¡œ</button>
    </div>
</div>

<div class="toast" id="toast"></div>

<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDOht0k-HMZ1V2kLPMj3Ho627PGoNgWkAg&callback=initApp&language=ko" async defer></script>

<script>
// ê°€ê²Œ ë°ì´í„°
const shops = [
    {id:1, name:"ì• ë‹ˆë©”ì´íŠ¸ í™ëŒ€ì ", address:"AKí”Œë¼ì 5ì¸µ", hours:"11:00-21:40", lat:37.557048, lng:126.924017, icon:"ğŸ­", type:"ì¢…í•©", genres:["ì•™ìŠ¤íƒ€","ë¸”ë£¨ë¡","í”¼ê·œì–´","ì—¬ì„±í–¥","ë‚¨ì„±í–¥"]},
    {id:2, name:"ëª¨ì™€ì¦", address:"ì™€ìš°ì‚°ë¡œ21ê¸¸ 28", hours:"12:00-20:00", lat:37.55211, lng:126.92094, icon:"ğŸ’–", type:"ì—¬ì„±í–¥", genres:["ì•™ìŠ¤íƒ€","ë¸”ë£¨ë¡","ì§„ê²©","ì´ì¹˜ë°©ì¿ ì§€"]},
    {id:3, name:"ìµœì• êµ¿ì¦ˆ", address:"ì”ë‹¤ë¦¬ë¡œ 13 B1", hours:"12:00-21:00", lat:37.55330, lng:126.92100, icon:"ğŸ’", type:"ì¤‘ê³ ", genres:["ì•™ìŠ¤íƒ€","ì—¬ì„±í–¥","ì¤‘ê³ "]},
    {id:4, name:"ì‹œë¡œìƒì ", address:"ì™€ìš°ì‚°ë¡œ29ê¸¸ B1", hours:"12:00-21:00", lat:37.55269, lng:126.92152, icon:"âœ¨", type:"ì¢…í•©", genres:["íŠ¸ë Œë“œ","ê°€ì± ","ì—¬ì„±í–¥","ë‚¨ì„±í–¥"]},
    {id:5, name:"ì• ë‹ˆí”ŒëŸ¬ìŠ¤ í•©ì •", address:"ë©”ì„¸ë‚˜í´ë¦¬ìŠ¤ B2", hours:"10:00-22:00", lat:37.54959, lng:126.91352, icon:"ğŸ¢", type:"ì¢…í•©", genres:["í”¼ê·œì–´","ì—¬ì„±í–¥","ë‚¨ì„±í–¥"]},
    {id:6, name:"ì˜¤ëª¨ì°¨ëœë“œ", address:"ì™€ìš°ì‚°ë¡œ29ê¸¸ 46", hours:"12:00-21:00", lat:37.55254, lng:126.92196, icon:"ğŸª", type:"ì¤‘ê³ ", genres:["ì•™ìŠ¤íƒ€","ì¤‘ê³ ","ë„ë¦¬ë²¤"]},
    {id:7, name:"ê¼¬ê¼¬êµ¿ì¦ˆ", address:"ì™€ìš°ì‚°ë¡œ27ê¸¸ 68 3ì¸µ", hours:"13:00-20:30", lat:37.55268, lng:126.92297, icon:"ğŸ", type:"ì¢…í•©", genres:["í•˜ì´í","ì£¼ìˆ íšŒì „","ì í”„"]},
    {id:8, name:"JSìŠ¤í† ì–´", address:"ì”ë‹¤ë¦¬ë¡œ6ê¸¸ 28", hours:"12:00-20:30", lat:37.55393, lng:126.92087, icon:"ğŸ¤–", type:"í”¼ê·œì–´", genres:["ì—ë°˜ê²Œë¦¬ì˜¨","ë‹¨ê°„ë¡ íŒŒ","ì½”ë“œê¸°ì–´ìŠ¤","ê°€ì± "]},
    {id:9, name:"í”¼ê·œì–´í”„ë Œì¦ˆ", address:"ì–‘í™”ë¡œ18ì•ˆê¸¸ 8 B1", hours:"13:00-21:00", lat:37.55392, lng:126.92360, icon:"ğŸ²", type:"í”¼ê·œì–´", genres:["í”¼ê·œì–´","ëœë¤ê¹¡","ì§€ë¥˜"]},
    {id:10, name:"ì•ˆì„œë‹¹", address:"ë™êµë™ 181-6 B1", hours:"12:00-20:00", lat:37.55481, lng:126.92305, icon:"ğŸª", type:"ì¤‘ê³ ", genres:["ìº”ë±ƒì§€","ì§€ë¥˜","ì˜›ë‚ êµ¿ì¦ˆ"]},
    {id:11, name:"í˜¸ì—ë§ˆì¼“", address:"í™ìµë¡œ6ê¸¸ 14", hours:"13:00-19:00", lat:37.55517, lng:126.92455, icon:"ğŸŒ¸", type:"ì†Œí’ˆ", genres:["ì‚°ë¦¬ì˜¤","ì›í™”êµ¿ì¦ˆ","ì í”„ìƒµ"]},
    {id:12, name:"ì• ë‹ˆì„¸ì¹´ì´", address:"ì–´ìš¸ë§ˆë‹¹ë¡œ 155-1", hours:"12:00-21:00", lat:37.55392, lng:126.92262, icon:"ğŸ®", type:"ì¢…í•©", genres:["ë¡œë³´ì½”","ë°ìŠ¤ë…¸íŠ¸","í¡í˜ˆê·€"]},
    {id:13, name:"í—¬ë¡œìˆ˜ë¯¸ì½”", address:"ì™€ìš°ì‚°ë¡œ29ê¸¸ 50", hours:"12:00-20:00", lat:37.55244, lng:126.92213, icon:"ğŸ²", type:"ê°€ì± ", genres:["ê°€ì± ","ì¸í˜•ì˜·"]},
    {id:14, name:"ë”ì¿ ", address:"í™ìµë¡œ6ê¸¸ 38 B1", hours:"12:00-21:00", lat:37.55502, lng:126.92373, icon:"ğŸ", type:"ì¢…í•©", genres:["ë¦¬ë©˜íŠ¸","ì•™ìŠ¤íƒ€","í”„ì„¸ì¹´"]},
    {id:15, name:"ì¼€ì´ë¶ìŠ¤", address:"EXITí™ëŒ€ B1", hours:"12:00-21:00", lat:37.55704, lng:126.92377, icon:"ğŸ“š", type:"ì¤‘ê³ ", genres:["ì¤‘ê³ ","ë™ì¸ì§€","íšŒì§€"]},
    {id:16, name:"ë¸Œë¼ë”êµ¿ì¦ˆ", address:"ì™€ìš°ì‚°ë¡œ 94", hours:"12:00-20:00", lat:37.55403, lng:126.92181, icon:"âš½", type:"ì¢…í•©", genres:["ë¸”ë£¨ë¡","ì£¼ìˆ íšŒì „","ì‚°ë¦¬ì˜¤","ë‹ˆì¼€"]},
    {id:17, name:"í”¼ê·œì–´í”„ë ˆì†Œ FP", address:"ì™€ìš°ì‚°ë¡œ29ê¸¸ 48-11", hours:"12:00-21:00", lat:37.55146, lng:126.92181, icon:"ğŸª", type:"í”¼ê·œì–´", genres:["ì œì¼ë³µê¶Œ","í”¼ê·œì–´"]},
    {id:18, name:"ìŠ¤í˜ì´ìŠ¤ ìš°ë¼ë¼", address:"í™ëŒ€ì…êµ¬ì—­ ì§€í•˜", hours:"12:00-21:00", lat:37.55703, lng:126.92410, icon:"ğŸš‡", type:"ì¢…í•©", genres:["ì´ì¹˜ë°©ì¿ ì§€","ì—ë°˜ê²Œë¦¬ì˜¨"]},
    {id:19, name:"ì›í”¼ê·œì–´", address:"í™ìµë¡œ6ê¸¸ 14 2ì¸µ", hours:"12:00-22:00", lat:37.55517, lng:126.92455, icon:"ğŸ¯", type:"í”¼ê·œì–´", genres:["í”¼ê·œì–´","íŒŒë¼ë¼ì´","ì…ë¬¸"]},
    {id:20, name:"ì˜¤ëª¨ì°¨ëœë“œ 2í˜¸ì ", address:"í™ëŒ€ì…êµ¬ì—­ ì§€í•˜", hours:"12:00-21:00", lat:37.55703, lng:126.92402, icon:"ğŸª", type:"ì¤‘ê³ ", genres:["ì•™ìŠ¤íƒ€","ì—¬ì„±í–¥","ì¤‘ê³ "]},
    {id:21, name:"ë‘ë‹ˆë¶€", address:"ì™€ìš°ì‚°ë¡œ13ê¸¸ 49", hours:"12:00-20:00", lat:37.55147, lng:126.92068, icon:"ğŸ¸", type:"ì¢…í•©", genres:["ì¼€ì´ì˜¨","ë§ˆë§ˆë§ˆ","ê³ ì „"]},
    {id:22, name:"ì•„ì´ë…¸ëª¨ë…¸", address:"ì”ë‹¤ë¦¬ë¡œ6ê¸¸ 36", hours:"12:00-21:00", lat:37.55430, lng:126.92150, icon:"ğŸ’«", type:"ì†Œí’ˆ", genres:["ìºìºì²´","ê±¸ë°´í¬","í¬ê·€ì¥ë¥´"]},
    {id:23, name:"ì• ë‹ˆí”Œë¼ì", address:"ì™€ìš°ì‚°ë¡œ29ê¸¸ 42", hours:"11:00-21:00", lat:37.55264, lng:126.92203, icon:"ğŸ«", type:"ë‚¨ì„±í–¥", genres:["ì œì¼ë³µê¶Œ","ë‚¨ì„±í–¥","í”¼ê·œì–´"]},
    {id:24, name:"í”¼ê·œì–´í”„ë ˆì†Œ í™ëŒ€", address:"ì”ë‹¤ë¦¬ë¡œ6ê¸¸ 25", hours:"12:00-21:00", lat:37.55352, lng:126.92247, icon:"ğŸ°", type:"í”¼ê·œì–´", genres:["ì œì¼ë³µê¶Œ","í”¼ê·œì–´"]},
    {id:25, name:"ë¼ì‹ ë°˜", address:"AKí”Œë¼ì", hours:"12:00-20:00", lat:37.557048, lng:126.924017, icon:"ğŸ“–", type:"ì¤‘ê³ ", genres:["í¬ì¹´","íšŒì§€","ìº”ë±ƒì§€"]}
];

const questions = [
    {
        text: "ì–´ë–¤ êµ¿ì¦ˆë¥¼ ì£¼ë¡œ ì°¾ì•„?",
        options: [
            {icon: "ğŸ¤–", main: "í”¼ê·œì–´ / ë³µê¶Œ", sub: "ì œì¼ë³µê¶Œ, í”„ë¼ëª¨ë¸, ë„¨ë„ë¡œì´ë“œ", value: "figure"},
            {icon: "ğŸ’–", main: "ì—¬ì„±í–¥", sub: "ì•™ìŠ¤íƒ€, ë¸”ë£¨ë¡, í•˜ì´í", value: "female"},
            {icon: "ğŸ”¥", main: "ë‚¨ì„±í–¥", sub: "ì—ë°˜ê²Œë¦¬ì˜¨, í”¼ê·œì–´", value: "male"},
            {icon: "ğŸŒŸ", main: "ë‹¤ ì¢‹ì•„!", sub: "ê³¨ê³ ë£¨ êµ¬ê²½í• ë˜", value: "all"}
        ]
    },
    {
        text: "êµ¿ì¦ˆìƒµ ê²½í—˜ì€?",
        options: [
            {icon: "ğŸ£", main: "ì²˜ìŒì´ì•¼", sub: "ê¸°ë³¸ë¶€í„° ì•Œë ¤ì¤˜", value: "beginner"},
            {icon: "ğŸ¥", main: "ëª‡ ë²ˆ ì™€ë´¤ì–´", sub: "ì–´ëŠ ì •ë„ ì•Œì•„", value: "intermediate"},
            {icon: "ğŸ¦…", main: "ë‹¨ê³¨ì´ì§€", sub: "ìˆ¨ì€ ë§›ì§‘ ì°¾ì•„ì¤˜", value: "expert"}
        ]
    }
];

// ìƒíƒœ
let map, freeMap, userLocation = null, userMarker = null, freeUserMarker = null;
let currentQuestion = 0;
let answers = {};
let recommendedShops = [];
let currentIndex = 0;
let sessionVisited = new Set(); // ì´ë²ˆ ì„¸ì…˜ ë°©ë¬¸
let tourMode = false;
let startTime = null;

const STORAGE_KEY = 'hongdae_goods_v3';
let savedData = JSON.parse(localStorage.getItem(STORAGE_KEY) || '{"visitedShops":[],"totalVisits":0}');

// ìœ í‹¸
function calcDist(lat1, lng1, lat2, lng2) {
    const R = 6371000;
    const dLat = (lat2-lat1) * Math.PI/180;
    const dLng = (lng2-lng1) * Math.PI/180;
    const a = Math.sin(dLat/2)**2 + Math.cos(lat1*Math.PI/180)*Math.cos(lat2*Math.PI/180)*Math.sin(dLng/2)**2;
    return R * 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
}

function formatDist(m) { return m < 1000 ? Math.round(m) + 'm' : (m/1000).toFixed(1) + 'km'; }
function formatWalk(m) { const mins = Math.round(m / 67); return mins < 1 ? '1ë¶„' : mins + 'ë¶„'; }

function updateDistances() {
    if (!userLocation) return;
    shops.forEach(s => {
        s.dist = calcDist(userLocation.lat, userLocation.lng, s.lat, s.lng);
        s.distText = formatDist(s.dist);
        s.walkTime = formatWalk(s.dist);
    });
}

function getShopStatus(shop) {
    const now = new Date();
    const h = now.getHours();
    const m = now.getMinutes();
    const currentMins = h * 60 + m;
    
    const [open, close] = shop.hours.split('-');
    const [oh, om] = open.split(':').map(Number);
    const [ch, cm] = close.split(':').map(Number);
    const openMins = oh * 60 + om;
    const closeMins = ch * 60 + cm;
    
    if (currentMins < openMins) {
        const diff = openMins - currentMins;
        if (diff <= 60) return { status: 'soon', text: `${diff}ë¶„ í›„ ì˜¤í”ˆ` };
        return { status: 'closed', text: 'ì˜ì—… ì „' };
    }
    if (currentMins >= closeMins) return { status: 'closed', text: 'ì˜ì—… ì¢…ë£Œ' };
    const remaining = closeMins - currentMins;
    if (remaining <= 60) return { status: 'open', text: `${remaining}ë¶„ í›„ ë§ˆê°` };
    return { status: 'open', text: 'ì˜ì—…ì¤‘' };
}

function isVisited(shopId) {
    return savedData.visitedShops.includes(shopId);
}

function markVisited(shopId) {
    if (!savedData.visitedShops.includes(shopId)) {
        savedData.visitedShops.push(shopId);
        saveData();
    }
    sessionVisited.add(shopId);
}

function unmarkVisited(shopId) {
    sessionVisited.delete(shopId);
}

function showToast(msg) {
    const t = document.getElementById('toast');
    t.textContent = msg;
    t.classList.add('show');
    setTimeout(() => t.classList.remove('show'), 2000);
}

function saveData() { localStorage.setItem(STORAGE_KEY, JSON.stringify(savedData)); }

// ì¸íŠ¸ë¡œ
function startOnboarding() {
    document.getElementById('intro').classList.add('hidden');
    document.getElementById('onboarding').classList.add('show');
    currentQuestion = 0;
    renderQuestion();
}

function startFreeMode() {
    document.getElementById('intro').classList.add('hidden');
    document.getElementById('freeApp').classList.add('show');
    
    setTimeout(() => {
        initFreeMap();
        updateFreeStats();
    }, 100);
}

function closeFreeMode() {
    document.getElementById('freeApp').classList.remove('show');
    document.getElementById('intro').classList.remove('hidden');
}

// ì˜¨ë³´ë”©
function renderQuestion() {
    const q = questions[currentQuestion];
    document.getElementById('progressFill').style.width = ((currentQuestion + 1) / questions.length * 100) + '%';
    
    document.getElementById('questionContent').innerHTML = `
        <div class="question-num">ì§ˆë¬¸ ${currentQuestion + 1}/${questions.length}</div>
        <div class="question-text">${q.text}</div>
        <div class="options">
            ${q.options.map((opt, i) => `
                <button class="option-btn" onclick="selectOption(${i}, '${opt.value}')">
                    <div class="option-icon">${opt.icon}</div>
                    <div class="option-text">
                        <span class="main">${opt.main}</span>
                        <span class="sub">${opt.sub}</span>
                    </div>
                </button>
            `).join('')}
        </div>
    `;
}

function selectOption(idx, value) {
    document.querySelectorAll('.option-btn').forEach((b, i) => b.classList.toggle('selected', i === idx));
    answers[currentQuestion] = value;
    
    setTimeout(() => {
        if (currentQuestion < questions.length - 1) {
            currentQuestion++;
            renderQuestion();
        } else {
            generateRecommendation();
        }
    }, 300);
}

function skipOnboarding() {
    answers = {0: 'all', 1: 'beginner'};
    generateRecommendation();
}

function backToOnboarding() {
    document.getElementById('resultScreen').classList.remove('show');
    document.getElementById('onboarding').classList.add('show');
    currentQuestion = 0;
    renderQuestion();
}

// ì¶”ì²œ ìƒì„±
function generateRecommendation() {
    document.getElementById('onboarding').classList.remove('show');
    
    const genre = answers[0] || 'all';
    const level = answers[1] || 'beginner';
    
    let title = '', desc = '', reasons = [];
    let filtered = [];
    
    // ì´ë¯¸ ë°©ë¬¸í•œ ê³³ ì œì™¸
    const unvisited = shops.filter(s => !isVisited(s.id));
    
    if (genre === 'figure') {
        title = 'ğŸ¤– í”¼ê·œì–´ í—Œí„° ì½”ìŠ¤';
        desc = 'í”¼ê·œì–´ì™€ ë³µê¶Œ ì°¾ëŠ” ë‹¹ì‹ ì„ ìœ„í•œ ì½”ìŠ¤';
        filtered = unvisited.filter(s => s.genres.some(g => ['í”¼ê·œì–´','ì œì¼ë³µê¶Œ','ì—ë°˜ê²Œë¦¬ì˜¨','ê°€ì± '].includes(g)));
        reasons = ['ì œì¼ë³µê¶Œ ìˆëŠ” ê³³ ìœ„ì£¼', 'í”¼ê·œì–´ ì¢…ë¥˜ ë§ì€ ë§¤ì¥', 'ê°€ê²©ëŒ€ ë‹¤ì–‘'];
    } else if (genre === 'female') {
        title = 'ğŸ’– ì—¬ì„±í–¥ ì„±ì§€ìˆœë¡€';
        desc = 'ì•™ìŠ¤íƒ€, ë¸”ë£¨ë¡, í•˜ì´í ë•í›„ ì½”ìŠ¤';
        filtered = unvisited.filter(s => s.genres.some(g => ['ì•™ìŠ¤íƒ€','ë¸”ë£¨ë¡','í•˜ì´í','ì—¬ì„±í–¥','ì£¼ìˆ íšŒì „'].includes(g)));
        reasons = ['ì•™ìŠ¤íƒ€/ë¸”ë£¨ë¡ ë§ì€ ê³³', 'ì´ì¹˜ë°©ì¿ ì§€ ê°€ëŠ¥', 'ì¤‘ê³ ìƒµ í¬í•¨'];
    } else if (genre === 'male') {
        title = 'ğŸ”¥ ë‚¨ì„±í–¥ í’€ì½”ìŠ¤';
        desc = 'ë‚¨ì„±í–¥ êµ¿ì¦ˆì™€ í”¼ê·œì–´ ì½”ìŠ¤';
        filtered = unvisited.filter(s => s.genres.some(g => ['ë‚¨ì„±í–¥','ì—ë°˜ê²Œë¦¬ì˜¨','ì œì¼ë³µê¶Œ'].includes(g)));
        reasons = ['ë‚¨ì„±í–¥ íŠ¹í™” ë§¤ì¥', 'ì œì¼ë³µê¶Œ ì¢…ë¥˜ ë‹¤ì–‘', 'ê°€ê²© ì €ë ´í•œ ê³³ í¬í•¨'];
    } else {
        title = 'ğŸŒŸ í™ëŒ€ êµ¿ì¦ˆìƒµ íˆ¬ì–´';
        desc = 'ë‹¤ì–‘í•œ ì¥ë¥´ ê³¨ê³ ë£¨ ì¦ê¸°ëŠ” ì½”ìŠ¤';
        filtered = unvisited.filter(s => s.type === 'ì¢…í•©');
        reasons = ['ì¢…í•© ë§¤ì¥ ìœ„ì£¼', 'ê·œëª¨ í° ê³³ ìš°ì„ ', 'ë‹¤ì–‘í•œ ì¥ë¥´'];
    }

    if (level === 'expert') {
        const rare = unvisited.filter(s => s.type === 'ì¤‘ê³ ' || s.genres.includes('í¬ê·€ì¥ë¥´'));
        filtered = [...filtered, ...rare];
        reasons.push('ìˆ¨ì€ ë§›ì§‘/ì¤‘ê³ ìƒµ í¬í•¨');
    }

    // ë°©ë¬¸ ì•ˆ í•œ ê³³ ìš°ì„ 
    if (savedData.visitedShops.length > 0) {
        reasons.push('ì´ë¯¸ ê°„ ê³³ì€ ì œì™¸í–ˆì–´ìš”');
    }

    if (filtered.length < 5) {
        const remaining = unvisited.filter(s => !filtered.includes(s));
        filtered = [...filtered, ...remaining];
    }

    // ì˜ì—…ì¤‘ + ê±°ë¦¬ìˆœ
    filtered.sort((a, b) => {
        const aStatus = getShopStatus(a).status === 'open' ? 0 : 1;
        const bStatus = getShopStatus(b).status === 'open' ? 0 : 1;
        if (aStatus !== bStatus) return aStatus - bStatus;
        return (a.dist || 0) - (b.dist || 0);
    });

    recommendedShops = filtered.slice(0, 5);

    document.getElementById('resultContent').innerHTML = `
        <div class="ai-card">
            <div class="ai-badge">âœ¨ AI ë§ì¶¤ ì¶”ì²œ</div>
            <div class="ai-title">${title}</div>
            <div class="ai-desc">${desc}</div>
            <div class="ai-reasons">
                <div class="ai-reasons-title">ì´ë ‡ê²Œ ì¶”ì²œí•œ ì´ìœ </div>
                ${reasons.map(r => `<div class="reason-item"><div class="reason-icon">âœ“</div><span>${r}</span></div>`).join('')}
            </div>
        </div>
        
        <div class="section-title"><span>ì¶”ì²œ ìˆœì„œ</span><span class="shop-count">${recommendedShops.length}ê³³</span></div>
        
        ${recommendedShops.map((shop, i) => {
            const status = getShopStatus(shop);
            return `
            <div class="shop-card ${i === 0 ? 'first' : ''}" onclick="openModal(${shop.id})">
                <div class="shop-photo">
                    ${shop.icon}
                    <div class="shop-status ${status.status}">${status.text}</div>
                    <div class="shop-rank-badge">${i + 1}</div>
                </div>
                <div class="shop-body">
                    <div class="shop-name-row">
                        <span class="shop-name">${shop.name}</span>
                    </div>
                    <div class="shop-meta">
                        <span>ğŸ“ ${shop.address}</span>
                        <span>ğŸ• ${shop.hours}</span>
                        ${shop.walkTime ? `<span>ğŸš¶ ${shop.walkTime}</span>` : ''}
                    </div>
                    <div class="shop-genres">
                        ${shop.genres.slice(0, 4).map(g => `<span class="genre-tag">#${g}</span>`).join('')}
                    </div>
                </div>
            </div>
        `}).join('')}
    `;
    
    document.getElementById('resultScreen').classList.add('show');
}

// íƒë°© ì‹œì‘
function startTour() {
    tourMode = true;
    currentIndex = 0;
    sessionVisited.clear();
    startTime = Date.now();
    
    document.getElementById('resultScreen').classList.remove('show');
    document.getElementById('app').classList.add('show');
    
    setTimeout(() => {
        google.maps.event.trigger(map, 'resize');
        updateCurrentDest();
        updateMap();
    }, 100);
}

// í˜„ì¬ ëª©ì ì§€
function updateCurrentDest() {
    const shop = recommendedShops[currentIndex];
    const next = recommendedShops[currentIndex + 1];
    const status = getShopStatus(shop);
    const isCurrentVisited = sessionVisited.has(shop.id);
    
    const stamps = recommendedShops.map((s, i) => 
        `<div class="stamp ${sessionVisited.has(s.id) ? 'done' : i === currentIndex ? 'current' : ''}">${sessionVisited.has(s.id) ? 'âœ“' : i + 1}</div>`
    ).join('');
    
    document.getElementById('currentDest').innerHTML = `
        <div class="dest-label">
            <span class="live-dot"></span>
            <span>${currentIndex + 1}/${recommendedShops.length} ë²ˆì§¸</span>
            <div class="stamps">${stamps}</div>
        </div>
        <div class="dest-shop">
            <div class="dest-photo">${shop.icon}</div>
            <div class="dest-info">
                <h2>${shop.name}</h2>
                <p>${shop.address}</p>
            </div>
            <div class="dest-walk">${shop.walkTime || '-'}</div>
        </div>
        <div class="dest-status-bar">
            <span class="status ${status.status}">${status.text}</span>
            <span class="hours">ğŸ• ${shop.hours}</span>
        </div>
        <div class="dest-genres">
            ${shop.genres.slice(0, 4).map(g => `<span class="genre-tag">#${g}</span>`).join('')}
        </div>
        <div class="dest-actions">
            ${isCurrentVisited ? `
                <button class="action-btn danger" onclick="undoComplete()">â†© ì·¨ì†Œ</button>
                <button class="action-btn primary" onclick="nextShop()">ë‹¤ìŒ â†’</button>
            ` : `
                <button class="action-btn secondary" onclick="openModal(${shop.id})">ìƒì„¸</button>
                <button class="action-btn success" onclick="completeShop()">âœ“ ë„ì°©</button>
            `}
        </div>
    `;
    
    document.getElementById('mapStatus').innerHTML = `
        <div class="map-status-icon">${shop.icon}</div>
        <div class="map-status-text">
            <div class="title">${shop.name}</div>
            <div class="sub">${shop.distText || '-'}</div>
        </div>
        <span class="map-status-badge ${status.status}">${status.text}</span>
    `;
    
    if (next) {
        const distToNext = calcDist(shop.lat, shop.lng, next.lat, next.lng);
        document.getElementById('nextPreview').innerHTML = `
            <div class="next-icon">${next.icon}</div>
            <div class="next-info">
                <div class="label">ë‹¤ìŒ ì¥ì†Œ</div>
                <h4>${next.name}</h4>
            </div>
            <div class="next-walk">â†’ ${formatWalk(distToNext)}</div>
        `;
        document.getElementById('nextPreview').style.display = 'flex';
    } else {
        document.getElementById('nextPreview').innerHTML = `<div class="next-info" style="width:100%;text-align:center"><div class="label">ğŸ‰ ë§ˆì§€ë§‰!</div></div>`;
    }
}

function completeShop() {
    markVisited(recommendedShops[currentIndex].id);
    showToast(`âœ“ ${recommendedShops[currentIndex].name} ì™„ë£Œ!`);
    updateCurrentDest();
    updateMap();
    
    // ëª¨ë‘ ì™„ë£Œ ì²´í¬
    const allDone = recommendedShops.every(s => sessionVisited.has(s.id));
    if (allDone) {
        setTimeout(() => showComplete(), 500);
    }
}

function undoComplete() {
    unmarkVisited(recommendedShops[currentIndex].id);
    showToast(`â†© ì·¨ì†Œë¨`);
    updateCurrentDest();
    updateMap();
}

function nextShop() {
    if (currentIndex < recommendedShops.length - 1) {
        currentIndex++;
        updateCurrentDest();
        updateMap();
    } else {
        showComplete();
    }
}

function showComplete() {
    const visitedList = recommendedShops.filter(s => sessionVisited.has(s.id));
    
    savedData.totalVisits++;
    saveData();
    
    document.getElementById('completeSubtext').textContent = `${visitedList.length}ê³³ ë°©ë¬¸ ì™„ë£Œ`;
    document.getElementById('completeContent').innerHTML = visitedList.map(shop => `
        <div class="complete-shop-card">
            <div class="complete-shop-icon">${shop.icon}</div>
            <div class="complete-shop-info">
                <h3>${shop.name}</h3>
                <p>${shop.address}</p>
            </div>
        </div>
    `).join('');
    
    document.getElementById('app').classList.remove('show');
    document.getElementById('completeScreen').classList.add('show');
}

function viewAllMap() {
    document.getElementById('completeScreen').classList.remove('show');
    startFreeMode();
}

// ì§€ë„
function initApp() {
    map = new google.maps.Map(document.getElementById('map'), {
        center: {lat: 37.556, lng: 126.923},
        zoom: 16,
        disableDefaultUI: true,
        zoomControl: true,
        gestureHandling: 'greedy',
        styles: [
            {elementType: "geometry", stylers: [{color: "#1d1d1f"}]},
            {elementType: "labels.text.fill", stylers: [{color: "#8e8e93"}]},
            {featureType: "road", elementType: "geometry", stylers: [{color: "#2c2c2e"}]},
            {featureType: "poi", stylers: [{visibility: "off"}]},
            {featureType: "water", stylers: [{color: "#0e0e0e"}]}
        ]
    });
    startTracking();
}

function initFreeMap() {
    if (freeMap) return;
    
    freeMap = new google.maps.Map(document.getElementById('freeMap'), {
        center: {lat: 37.556, lng: 126.923},
        zoom: 15,
        disableDefaultUI: true,
        zoomControl: true,
        gestureHandling: 'greedy',
        styles: [
            {elementType: "geometry", stylers: [{color: "#1d1d1f"}]},
            {elementType: "labels.text.fill", stylers: [{color: "#8e8e93"}]},
            {featureType: "road", elementType: "geometry", stylers: [{color: "#2c2c2e"}]},
            {featureType: "poi", stylers: [{visibility: "off"}]},
            {featureType: "water", stylers: [{color: "#0e0e0e"}]}
        ]
    });
    
    updateFreeMap();
}

function updateFreeStats() {
    const visited = savedData.visitedShops.length;
    const total = shops.length;
    document.getElementById('freeStats').innerHTML = `
        <div class="stat-item">ì „ì²´ <strong>${total}</strong>ê³³</div>
        <div class="stat-item">ë°©ë¬¸ <strong>${visited}</strong>ê³³</div>
        <div class="stat-item">ë¯¸ë°©ë¬¸ <strong>${total - visited}</strong>ê³³</div>
    `;
}

function updateFreeMap() {
    const bounds = new google.maps.LatLngBounds();
    
    shops.forEach(shop => {
        const visited = isVisited(shop.id);
        const status = getShopStatus(shop);
        
        const marker = new google.maps.Marker({
            position: {lat: shop.lat, lng: shop.lng},
            map: freeMap,
            icon: {
                url: `data:image/svg+xml,${encodeURIComponent(`
                    <svg width="44" height="52" xmlns="http://www.w3.org/2000/svg">
                        <circle cx="22" cy="22" r="20" fill="${visited ? '#30d158' : status.status === 'open' ? '#333' : '#1a1a1a'}" stroke="${visited ? '#30d158' : status.status === 'open' ? '#fff' : '#666'}" stroke-width="2"/>
                        <text x="22" y="29" font-size="20" text-anchor="middle">${visited ? 'âœ“' : shop.icon}</text>
                    </svg>
                `)}`,
                scaledSize: new google.maps.Size(44, 52),
                anchor: new google.maps.Point(22, 26)
            }
        });
        
        marker.addListener('click', () => openModal(shop.id));
        bounds.extend({lat: shop.lat, lng: shop.lng});
    });
    
    if (userLocation) {
        bounds.extend(userLocation);
        if (!freeUserMarker) {
            freeUserMarker = new google.maps.Marker({
                position: userLocation,
                map: freeMap,
                icon: { path: google.maps.SymbolPath.CIRCLE, scale: 10, fillColor: '#007aff', fillOpacity: 1, strokeColor: '#fff', strokeWeight: 3 },
                zIndex: 1000
            });
        }
    }
    
    freeMap.fitBounds(bounds, 50);
}

function startTracking() {
    if (!navigator.geolocation) return;
    navigator.geolocation.watchPosition(
        pos => {
            userLocation = {lat: pos.coords.latitude, lng: pos.coords.longitude};
            updateDistances();
            
            if (!userMarker && map) {
                userMarker = new google.maps.Marker({
                    position: userLocation,
                    map,
                    icon: { path: google.maps.SymbolPath.CIRCLE, scale: 10, fillColor: '#007aff', fillOpacity: 1, strokeColor: '#fff', strokeWeight: 3 },
                    zIndex: 1000
                });
            } else if (userMarker) {
                userMarker.setPosition(userLocation);
            }
            
            if (freeUserMarker) freeUserMarker.setPosition(userLocation);
            
            if (tourMode) updateCurrentDest();
        },
        () => {},
        {enableHighAccuracy: true, timeout: 15000, maximumAge: 0}
    );
}

function updateMap() {
    if (window.shopMarkers) window.shopMarkers.forEach(m => m.setMap(null));
    if (window.routeLine) window.routeLine.setMap(null);
    window.shopMarkers = [];
    
    const bounds = new google.maps.LatLngBounds();
    if (userLocation) bounds.extend(userLocation);
    
    const pathCoords = userLocation ? [userLocation] : [];
    
    recommendedShops.forEach((shop, idx) => {
        const isCurrent = idx === currentIndex;
        const isDone = sessionVisited.has(shop.id);
        
        const marker = new google.maps.Marker({
            position: {lat: shop.lat, lng: shop.lng},
            map,
            icon: {
                url: `data:image/svg+xml,${encodeURIComponent(`
                    <svg width="48" height="56" xmlns="http://www.w3.org/2000/svg">
                        <circle cx="24" cy="24" r="22" fill="${isDone ? '#30d158' : isCurrent ? '#007aff' : '#333'}" stroke="white" stroke-width="3"/>
                        <text x="24" y="31" font-size="22" text-anchor="middle" fill="white">${isDone ? 'âœ“' : shop.icon}</text>
                        ${isCurrent && !isDone ? '<circle cx="24" cy="24" r="22" fill="none" stroke="#007aff" stroke-width="3" opacity="0.5"><animate attributeName="r" from="22" to="32" dur="1.5s" repeatCount="indefinite"/><animate attributeName="opacity" from="0.5" to="0" dur="1.5s" repeatCount="indefinite"/></circle>' : ''}
                    </svg>
                `)}`,
                scaledSize: new google.maps.Size(48, 56),
                anchor: new google.maps.Point(24, 28)
            },
            zIndex: isCurrent ? 500 : 100
        });
        
        marker.addListener('click', () => openModal(shop.id));
        window.shopMarkers.push(marker);
        bounds.extend({lat: shop.lat, lng: shop.lng});
        pathCoords.push({lat: shop.lat, lng: shop.lng});
    });
    
    window.routeLine = new google.maps.Polyline({
        path: pathCoords,
        geodesic: true,
        strokeColor: '#007aff',
        strokeOpacity: 0,
        icons: [{icon: {path: 'M 0,-1 0,1', strokeOpacity: 0.6, scale: 3}, offset: '0', repeat: '15px'}]
    });
    window.routeLine.setMap(map);
    map.fitBounds(bounds, 80);
}

function goToMyLocation() {
    if (userLocation && map) { map.panTo(userLocation); map.setZoom(17); }
}

function goToMyLocationFree() {
    if (userLocation && freeMap) { freeMap.panTo(userLocation); freeMap.setZoom(17); }
}

// ëª¨ë‹¬
function openModal(shopId) {
    const shop = shops.find(s => s.id === shopId);
    if (!shop) return;
    const status = getShopStatus(shop);
    const visited = isVisited(shop.id);
    
    document.getElementById('modalContent').innerHTML = `
        <div class="modal-photo">
            ${shop.icon}
            <span class="modal-status ${status.status}">${status.text}</span>
        </div>
        
        <div class="modal-title-row">
            <span class="modal-title">${shop.name}</span>
            ${visited ? '<span class="genre-tag" style="background:var(--success);color:#fff;">âœ“ ë°©ë¬¸í•¨</span>' : ''}
        </div>
        
        <div class="modal-meta">
            <span>ğŸ“ ${shop.address}</span>
            ${shop.walkTime ? `<span>ğŸš¶ ${shop.walkTime}</span>` : ''}
        </div>
        
        <div class="modal-genres">
            ${shop.genres.map(g => `<span class="genre-tag">#${g}</span>`).join('')}
        </div>
        
        <div class="modal-info">
            <div class="modal-info-row"><span class="icon">ğŸ•</span>${shop.hours}</div>
            <div class="modal-info-row"><span class="icon">ğŸ·</span>${shop.type}</div>
            ${shop.distText ? `<div class="modal-info-row"><span class="icon">ğŸ“</span>${shop.distText}</div>` : ''}
        </div>
        
        <div class="modal-actions">
            <button class="modal-btn secondary" onclick="closeModal()">ë‹«ê¸°</button>
            ${visited ? '' : `<button class="modal-btn success" onclick="markVisitedFromModal(${shop.id})">âœ“ ë°©ë¬¸ ì™„ë£Œ</button>`}
        </div>
    `;
    document.getElementById('modal').classList.add('show');
}

function markVisitedFromModal(shopId) {
    markVisited(shopId);
    showToast('âœ“ ë°©ë¬¸ ì™„ë£Œë¡œ ì €ì¥ë¨');
    closeModal();
    if (freeMap) {
        updateFreeMap();
        updateFreeStats();
    }
}

function closeModal(e) {
    if (e && e.target.id !== 'modal') return;
    document.getElementById('modal').classList.remove('show');
}

function shareCourse() {
    const text = `ğŸ­ í™ëŒ€ êµ¿ì¦ˆìƒµ ì¶”ì²œ\n\n${recommendedShops.map((s, i) => `${i+1}. ${s.name}`).join('\n')}\n\n#í™ëŒ€êµ¿ì¦ˆìƒµ`;
    if (navigator.share) navigator.share({title: 'í™ëŒ€ êµ¿ì¦ˆìƒµ', text});
    else { navigator.clipboard.writeText(text); showToast('ğŸ“‹ ë³µì‚¬ë¨!'); }
}

function resetApp() { location.reload(); }
</script>

</body>
</html>
