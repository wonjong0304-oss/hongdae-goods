<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>í™ëŒ€ êµ¿ì¦ˆìƒµ</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-overflow-scrolling: touch; }
        :root { --bg: #0a0a0f; --card: #1c1c1e; --text: #fff; --text-sub: #8e8e93; --primary: #007aff; --success: #30d158; --danger: #ff453a; --warning: #ff9f0a; }
        body.light-mode { --bg: #f2f2f7; --card: #fff; --text: #000; --text-sub: #6e6e73; }
        body { font-family: -apple-system, BlinkMacSystemFont, sans-serif; background: var(--bg); color: var(--text); min-height: 100vh; line-height: 1.4; }

        .global-theme { position: fixed; top: 16px; right: 16px; z-index: 400; padding: 8px 12px; background: var(--card); border: none; border-radius: 20px; font-size: 14px; color: var(--text); cursor: pointer; box-shadow: 0 2px 10px rgba(0,0,0,0.3); }
        .global-theme.hide { display: none; }

        .intro { position: fixed; inset: 0; background: linear-gradient(180deg, #0a0a1a, #1a1a2e, #0a0a0f); z-index: 300; display: flex; flex-direction: column; padding: 60px 24px 40px; overflow-y: auto; }
        body.light-mode .intro { background: linear-gradient(180deg, #e8e8f0, #d8d8e8, #f2f2f7); }
        .intro.hide { display: none; }
        .intro-content { flex: 1; display: flex; flex-direction: column; justify-content: center; max-width: 400px; margin: 0 auto; width: 100%; }
        .intro-emoji { font-size: 64px; margin-bottom: 24px; }
        .intro-title { font-size: 28px; font-weight: 800; line-height: 1.3; margin-bottom: 28px; }
        .intro-title .hl { color: var(--primary); }
        .benefits { display: flex; flex-direction: column; gap: 12px; margin-bottom: 32px; }
        .benefit { display: flex; align-items: center; gap: 12px; padding: 14px; background: rgba(255,255,255,0.05); border-radius: 12px; }
        body.light-mode .benefit { background: rgba(0,0,0,0.03); }
        .benefit-icon { width: 40px; height: 40px; background: linear-gradient(135deg, var(--primary), #5856d6); border-radius: 10px; display: flex; align-items: center; justify-content: center; font-size: 18px; }
        .benefit-text .main { font-size: 15px; font-weight: 700; }
        .benefit-text .sub { font-size: 12px; color: var(--text-sub); }
        .intro-cta { width: 100%; padding: 16px; background: var(--primary); border: none; border-radius: 14px; font-size: 17px; font-weight: 700; color: #fff; cursor: pointer; margin-bottom: 10px; }
        .intro-skip { width: 100%; padding: 14px; background: var(--card); border: none; border-radius: 14px; font-size: 15px; font-weight: 600; color: var(--text); cursor: pointer; }
        .intro-footer { text-align: center; font-size: 12px; color: var(--text-sub); margin-top: 16px; }

        .onboarding { position: fixed; inset: 0; background: var(--bg); z-index: 200; display: none; flex-direction: column; overflow-y: auto; }
        .onboarding.show { display: flex; }
        .ob-header { padding: 20px; display: flex; align-items: center; gap: 16px; }
        .progress-bar { flex: 1; height: 4px; background: rgba(255,255,255,0.1); border-radius: 2px; }
        body.light-mode .progress-bar { background: rgba(0,0,0,0.1); }
        .progress-fill { height: 100%; background: var(--primary); border-radius: 2px; transition: width 0.3s; }
        .skip-btn { font-size: 14px; color: var(--text-sub); background: none; border: none; cursor: pointer; }
        .ob-content { flex: 1; display: flex; flex-direction: column; justify-content: center; padding: 20px 24px 40px; max-width: 500px; margin: 0 auto; width: 100%; }
        .q-num { font-size: 13px; color: var(--primary); font-weight: 700; margin-bottom: 10px; }
        .q-text { font-size: 24px; font-weight: 800; margin-bottom: 28px; }
        .options { display: flex; flex-direction: column; gap: 10px; }
        .opt-btn { padding: 16px; background: var(--card); border: 2px solid rgba(255,255,255,0.1); border-radius: 14px; font-size: 15px; font-weight: 600; color: var(--text); text-align: left; cursor: pointer; display: flex; align-items: center; gap: 12px; transition: all 0.2s; }
        body.light-mode .opt-btn { border-color: rgba(0,0,0,0.1); }
        .opt-btn.sel { border-color: var(--primary); background: rgba(0,122,255,0.15); }
        .opt-icon { font-size: 24px; width: 40px; height: 40px; background: rgba(255,255,255,0.1); border-radius: 10px; display: flex; align-items: center; justify-content: center; }
        body.light-mode .opt-icon { background: rgba(0,0,0,0.05); }
        .opt-btn.sel .opt-icon { background: var(--primary); }
        .opt-text { flex: 1; }
        .opt-text .main { display: block; margin-bottom: 2px; }
        .opt-text .sub { font-size: 12px; color: var(--text-sub); font-weight: 400; }

        .result { position: fixed; inset: 0; background: var(--bg); z-index: 200; display: none; flex-direction: column; }
        .result.show { display: flex; }
        .result-header { padding: 16px 20px; display: flex; align-items: center; gap: 12px; border-bottom: 1px solid rgba(255,255,255,0.1); }
        body.light-mode .result-header { border-color: rgba(0,0,0,0.1); }
        .back-btn { width: 36px; height: 36px; background: var(--card); border: none; border-radius: 10px; font-size: 18px; cursor: pointer; color: var(--text); }
        .result-header h1 { font-size: 17px; font-weight: 700; }
        .result-content { flex: 1; overflow-y: auto; padding: 20px; padding-bottom: 180px; }
        .ai-card { background: linear-gradient(135deg, #1a1a2e, #16213e); border-radius: 16px; padding: 20px; margin-bottom: 20px; }
        body.light-mode .ai-card { background: linear-gradient(135deg, #e8e8f8, #d8d8f0); }
        .ai-badge { display: inline-flex; padding: 5px 10px; background: linear-gradient(135deg, #667eea, #764ba2); border-radius: 16px; font-size: 11px; font-weight: 700; color: #fff; margin-bottom: 12px; }
        .ai-title { font-size: 20px; font-weight: 800; margin-bottom: 6px; }
        .ai-desc { font-size: 14px; color: var(--text-sub); margin-bottom: 16px; }
        .ai-reasons { background: rgba(255,255,255,0.05); border-radius: 10px; padding: 14px; }
        body.light-mode .ai-reasons { background: rgba(0,0,0,0.05); }
        .ai-reasons-title { font-size: 12px; font-weight: 700; color: var(--text-sub); margin-bottom: 10px; }
        .reason { display: flex; align-items: flex-start; gap: 8px; margin-bottom: 8px; font-size: 13px; }
        .reason:last-child { margin-bottom: 0; }
        .reason-icon { width: 18px; height: 18px; background: var(--primary); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 10px; flex-shrink: 0; color: #fff; }
        .section-title { font-size: 13px; font-weight: 700; color: var(--text-sub); margin-bottom: 12px; display: flex; justify-content: space-between; }
        .shop-count { color: var(--primary); }

        .shop-card { background: var(--card); border-radius: 14px; overflow: hidden; margin-bottom: 10px; cursor: pointer; }
        .shop-card.first { border: 1px solid rgba(0,122,255,0.3); }
        .shop-photo { width: 100%; height: 90px; background: linear-gradient(135deg, #2c2c2e, #1c1c1e); display: flex; align-items: center; justify-content: center; font-size: 36px; position: relative; }
        body.light-mode .shop-photo { background: linear-gradient(135deg, #e8e8e8, #d8d8d8); }
        .shop-status { position: absolute; top: 8px; left: 8px; padding: 5px 8px; border-radius: 6px; font-size: 11px; font-weight: 700; }
        .shop-status.open { background: var(--success); color: #fff; }
        .shop-status.closed { background: var(--danger); color: #fff; }
        .shop-status.soon { background: var(--warning); color: #000; }
        .shop-rank { position: absolute; top: 8px; right: 8px; width: 24px; height: 24px; background: var(--primary); border-radius: 6px; display: flex; align-items: center; justify-content: center; font-size: 12px; font-weight: 800; color: #fff; }
        .shop-body { padding: 12px; }
        .shop-name-row { display: flex; align-items: center; gap: 8px; margin-bottom: 6px; }
        .shop-name { font-size: 15px; font-weight: 700; }
        .shop-type { padding: 2px 6px; background: rgba(167,139,250,0.2); border-radius: 4px; font-size: 10px; font-weight: 600; color: #a78bfa; }
        .shop-meta { display: flex; align-items: center; gap: 10px; font-size: 12px; color: var(--text-sub); margin-bottom: 8px; flex-wrap: wrap; }
        .shop-genres { display: flex; flex-wrap: wrap; gap: 4px; }
        .genre-tag { padding: 3px 8px; background: rgba(255,255,255,0.08); border-radius: 4px; font-size: 11px; font-weight: 600; color: #a78bfa; }
        body.light-mode .genre-tag { background: rgba(0,0,0,0.05); }

        .result-footer { position: fixed; bottom: 0; left: 0; right: 0; padding: 16px 20px 32px; background: var(--bg); border-top: 1px solid rgba(255,255,255,0.1); z-index: 10; }
        body.light-mode .result-footer { border-color: rgba(0,0,0,0.1); }
        .start-btn { width: 100%; padding: 16px; background: var(--primary); border: none; border-radius: 12px; font-size: 16px; font-weight: 700; color: #fff; cursor: pointer; margin-bottom: 8px; }
        .secondary-btns { display: flex; gap: 8px; }
        .sec-btn { flex: 1; padding: 12px; background: var(--card); border: none; border-radius: 10px; font-size: 13px; font-weight: 600; color: var(--text); cursor: pointer; }

        .app { display: none; flex-direction: column; height: 100vh; height: 100dvh; }
        .app.show { display: flex; }
        .current-dest { background: var(--card); padding: 16px; border-bottom: 1px solid rgba(255,255,255,0.1); max-height: 40vh; overflow-y: auto; }
        body.light-mode .current-dest { border-color: rgba(0,0,0,0.1); }
        .dest-label { display: flex; align-items: center; gap: 8px; font-size: 12px; color: var(--text-sub); margin-bottom: 10px; }
        .live-dot { width: 6px; height: 6px; background: var(--success); border-radius: 50%; animation: blink 1.5s infinite; }
        @keyframes blink { 0%, 100% { opacity: 1; } 50% { opacity: 0.3; } }
        .stamps { display: flex; gap: 4px; margin-left: auto; }
        .stamp { width: 22px; height: 22px; background: rgba(255,255,255,0.1); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 10px; font-weight: 700; }
        body.light-mode .stamp { background: rgba(0,0,0,0.1); }
        .stamp.done { background: var(--success); color: #fff; }
        .stamp.current { background: var(--primary); color: #fff; }
        .dest-shop { display: flex; align-items: center; gap: 12px; margin-bottom: 12px; }
        .dest-photo { width: 56px; height: 56px; background: rgba(0,122,255,0.2); border: 2px solid var(--primary); border-radius: 14px; display: flex; align-items: center; justify-content: center; font-size: 28px; }
        .dest-info { flex: 1; }
        .dest-info h2 { font-size: 18px; font-weight: 800; margin-bottom: 2px; }
        .dest-info p { font-size: 13px; color: var(--text-sub); }
        .dest-walk { padding: 6px 12px; background: var(--primary); border-radius: 16px; font-size: 14px; font-weight: 700; color: #fff; }
        .dest-status-bar { display: flex; align-items: center; gap: 10px; padding: 10px 12px; background: rgba(255,255,255,0.05); border-radius: 10px; margin-bottom: 10px; }
        body.light-mode .dest-status-bar { background: rgba(0,0,0,0.05); }
        .dest-status-bar .status { padding: 4px 10px; border-radius: 6px; font-size: 12px; font-weight: 700; color: #fff; }
        .dest-status-bar .status.open { background: var(--success); }
        .dest-status-bar .status.closed { background: var(--danger); }
        .dest-status-bar .hours { font-size: 13px; color: var(--text-sub); }
        .dest-genres { display: flex; flex-wrap: wrap; gap: 4px; margin-bottom: 12px; }
        .dest-actions { display: flex; gap: 8px; }
        .action-btn { flex: 1; padding: 12px; border: none; border-radius: 10px; font-size: 14px; font-weight: 700; cursor: pointer; color: #fff; }
        .action-btn.primary { background: var(--primary); }
        .action-btn.secondary { background: rgba(255,255,255,0.1); }
        body.light-mode .action-btn.secondary { background: rgba(0,0,0,0.1); color: var(--text); }
        .action-btn.success { background: var(--success); }
        .action-btn.danger { background: var(--danger); }

        .map-container { flex: 1; position: relative; min-height: 200px; }
        #map, #freeMap { width: 100%; height: 100%; }
        .map-status { position: absolute; top: 12px; left: 12px; right: 60px; background: rgba(0,0,0,0.85); backdrop-filter: blur(10px); border-radius: 12px; padding: 12px 14px; display: flex; align-items: center; gap: 10px; z-index: 10; }
        body.light-mode .map-status { background: rgba(255,255,255,0.9); }
        .map-status-icon { width: 36px; height: 36px; background: var(--primary); border-radius: 10px; display: flex; align-items: center; justify-content: center; font-size: 18px; }
        .map-status-text { flex: 1; }
        .map-status-text .title { font-size: 14px; font-weight: 700; }
        .map-status-text .sub { font-size: 12px; color: var(--text-sub); }
        .map-status-badge { padding: 4px 8px; border-radius: 6px; font-size: 11px; font-weight: 700; color: #fff; }
        .map-status-badge.open { background: var(--success); }
        .map-status-badge.closed { background: var(--danger); }
        .map-btn { position: absolute; width: 44px; height: 44px; background: var(--card); border: none; border-radius: 50%; font-size: 20px; cursor: pointer; box-shadow: 0 2px 10px rgba(0,0,0,0.3); z-index: 10; }
        .loc-btn { bottom: 90px; right: 12px; }
        .next-preview { position: absolute; bottom: 12px; left: 12px; right: 12px; background: var(--card); border-radius: 14px; padding: 14px; display: flex; align-items: center; gap: 12px; box-shadow: 0 2px 15px rgba(0,0,0,0.3); z-index: 10; }
        .next-icon { width: 44px; height: 44px; background: rgba(255,255,255,0.1); border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 22px; }
        body.light-mode .next-icon { background: rgba(0,0,0,0.05); }
        .next-info { flex: 1; }
        .next-info .label { font-size: 11px; color: var(--text-sub); font-weight: 600; }
        .next-info h4 { font-size: 15px; font-weight: 700; }
        .next-walk { font-size: 14px; font-weight: 700; color: var(--primary); }

        .free-header { background: var(--card); padding: 14px 16px; display: flex; align-items: center; justify-content: space-between; border-bottom: 1px solid rgba(255,255,255,0.1); }
        body.light-mode .free-header { border-color: rgba(0,0,0,0.1); }
        .free-header h1 { font-size: 17px; font-weight: 700; }
        .free-header .close-btn { width: 32px; height: 32px; background: rgba(255,255,255,0.1); border: none; border-radius: 8px; font-size: 16px; cursor: pointer; color: var(--text); }
        body.light-mode .free-header .close-btn { background: rgba(0,0,0,0.05); }
        .toolbar { background: var(--bg); padding: 10px 16px; border-bottom: 1px solid rgba(255,255,255,0.05); }
        body.light-mode .toolbar { border-color: rgba(0,0,0,0.05); }
        .filter-row { display: flex; gap: 6px; overflow-x: auto; padding-bottom: 8px; margin-bottom: 8px; }
        .filter-row::-webkit-scrollbar { display: none; }
        .filter-chip { padding: 6px 12px; background: var(--card); border: 1px solid rgba(255,255,255,0.1); border-radius: 16px; font-size: 12px; font-weight: 600; color: var(--text); cursor: pointer; white-space: nowrap; }
        body.light-mode .filter-chip { border-color: rgba(0,0,0,0.1); }
        .filter-chip.active { background: var(--primary); border-color: var(--primary); color: #fff; }
        .stats-row { display: flex; gap: 12px; font-size: 12px; color: var(--text-sub); }
        .stats-row strong { color: var(--primary); }

        .modal-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.7); z-index: 100; display: none; align-items: flex-end; }
        .modal-overlay.show { display: flex; }
        .modal { background: var(--card); border-radius: 20px 20px 0 0; width: 100%; max-height: 85vh; overflow-y: auto; }
        .modal-handle { width: 32px; height: 4px; background: rgba(255,255,255,0.2); border-radius: 2px; margin: 8px auto; }
        body.light-mode .modal-handle { background: rgba(0,0,0,0.2); }
        .modal-content { padding: 0 16px 28px; }
        .modal-photo { width: 100%; height: 120px; background: linear-gradient(135deg, #2c2c2e, #1c1c1e); border-radius: 14px; display: flex; align-items: center; justify-content: center; font-size: 48px; margin-bottom: 16px; position: relative; }
        body.light-mode .modal-photo { background: linear-gradient(135deg, #e8e8e8, #d8d8d8); }
        .modal-status { position: absolute; bottom: 10px; left: 10px; padding: 6px 12px; border-radius: 8px; font-size: 13px; font-weight: 700; color: #fff; }
        .modal-status.open { background: var(--success); }
        .modal-status.closed { background: var(--danger); }
        .modal-title-row { display: flex; align-items: center; gap: 8px; margin-bottom: 6px; flex-wrap: wrap; }
        .modal-title { font-size: 22px; font-weight: 800; }
        .modal-meta { display: flex; align-items: center; gap: 10px; font-size: 13px; color: var(--text-sub); margin-bottom: 12px; flex-wrap: wrap; }
        .modal-genres { display: flex; flex-wrap: wrap; gap: 6px; margin-bottom: 16px; }
        .modal-info { background: rgba(255,255,255,0.05); border-radius: 12px; overflow: hidden; margin-bottom: 16px; }
        body.light-mode .modal-info { background: rgba(0,0,0,0.05); }
        .modal-info-row { display: flex; align-items: center; gap: 10px; padding: 12px 14px; border-bottom: 1px solid rgba(255,255,255,0.05); font-size: 14px; }
        body.light-mode .modal-info-row { border-color: rgba(0,0,0,0.05); }
        .modal-info-row:last-child { border-bottom: none; }
        .modal-info-row .icon { font-size: 16px; width: 20px; text-align: center; }
        .review-section { margin-bottom: 16px; }
        .review-title { font-size: 13px; font-weight: 700; color: var(--text-sub); margin-bottom: 10px; }
        .review-input-wrap { display: flex; gap: 8px; margin-bottom: 10px; }
        .review-input { flex: 1; padding: 10px 14px; background: rgba(255,255,255,0.05); border: none; border-radius: 10px; font-size: 14px; color: var(--text); }
        body.light-mode .review-input { background: rgba(0,0,0,0.05); }
        .review-input::placeholder { color: var(--text-sub); }
        .review-submit { padding: 10px 14px; background: var(--primary); border: none; border-radius: 10px; font-size: 13px; font-weight: 700; color: #fff; cursor: pointer; }
        .review-list { display: flex; flex-direction: column; gap: 6px; }
        .review-item { padding: 10px 12px; background: rgba(255,255,255,0.05); border-radius: 8px; font-size: 13px; }
        body.light-mode .review-item { background: rgba(0,0,0,0.05); }
        .review-item .date { font-size: 10px; color: var(--text-sub); margin-top: 4px; }
        .modal-actions { display: flex; gap: 8px; }
        .modal-btn { flex: 1; padding: 14px; border: none; border-radius: 12px; font-size: 15px; font-weight: 700; cursor: pointer; color: #fff; }
        .modal-btn.primary { background: var(--primary); }
        .modal-btn.secondary { background: rgba(255,255,255,0.1); }
        body.light-mode .modal-btn.secondary { background: rgba(0,0,0,0.1); color: var(--text); }
        .modal-btn.success { background: var(--success); }
        .modal-btn.danger { background: var(--danger); }

        .complete { position: fixed; inset: 0; background: var(--bg); z-index: 150; display: none; flex-direction: column; }
        .complete.show { display: flex; }
        .complete-header { padding: 20px; text-align: center; border-bottom: 1px solid rgba(255,255,255,0.1); }
        body.light-mode .complete-header { border-color: rgba(0,0,0,0.1); }
        .complete-header h2 { font-size: 22px; font-weight: 800; }
        .complete-header p { font-size: 13px; color: var(--text-sub); margin-top: 4px; }
        .complete-content { flex: 1; overflow-y: auto; padding: 16px; }
        .complete-card { background: var(--card); border-radius: 12px; padding: 14px; margin-bottom: 10px; display: flex; align-items: center; gap: 12px; }
        .complete-icon { width: 48px; height: 48px; background: var(--success); border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 24px; }
        .complete-info { flex: 1; }
        .complete-info h3 { font-size: 15px; font-weight: 700; margin-bottom: 2px; }
        .complete-info p { font-size: 12px; color: var(--text-sub); }
        .complete-footer { padding: 16px 20px 32px; border-top: 1px solid rgba(255,255,255,0.1); }
        body.light-mode .complete-footer { border-color: rgba(0,0,0,0.1); }
        .complete-btn { width: 100%; padding: 14px; border: none; border-radius: 12px; font-size: 15px; font-weight: 700; cursor: pointer; margin-bottom: 8px; color: #fff; }
        .complete-btn.primary { background: var(--primary); }
        .complete-btn.secondary { background: rgba(255,255,255,0.1); }
        body.light-mode .complete-btn.secondary { background: rgba(0,0,0,0.1); color: var(--text); }

        .toast { position: fixed; bottom: 100px; left: 50%; transform: translateX(-50%); background: #333; padding: 12px 20px; border-radius: 10px; font-size: 14px; font-weight: 600; z-index: 500; display: none; color: #fff; }
        .toast.show { display: block; }
    </style>
</head>
<body>

<button class="global-theme" id="globalTheme" onclick="toggleTheme()">ğŸŒ™</button>

<div class="intro" id="intro">
    <div class="intro-content">
        <div class="intro-emoji">ğŸ­</div>
        <h1 class="intro-title">í™ëŒ€ ë•ì§ˆ,<br><span class="hl">ì–´ë””ë¶€í„° ê°€ì•¼ í• ì§€</span><br>ë§‰ë§‰í–ˆë‹¤ë©´?</h1>
        <div class="benefits">
            <div class="benefit"><div class="benefit-icon">ğŸ¯</div><div class="benefit-text"><div class="main">ë‚´ ì·¨í–¥ ë§ì¶¤ ë£¨íŠ¸</div><div class="sub">ì—¬ì„±í–¥ / í”¼ê·œì–´ / ì¤‘ê³  ì·¨í–¥ë³„ ì¶”ì²œ</div></div></div>
            <div class="benefit"><div class="benefit-icon">â°</div><div class="benefit-text"><div class="main">ì˜ì—…ì¤‘ì¸ ê³³ ìš°ì„ </div><div class="sub">ì§€ê¸ˆ ì—´ë ¤ìˆëŠ” ê°€ê²Œ ë¨¼ì € ì•ˆë‚´</div></div></div>
            <div class="benefit"><div class="benefit-icon">ğŸ“</div><div class="benefit-text"><div class="main">ë°©ë¬¸ ê¸°ë¡ ì €ì¥</div><div class="sub">ë‹¤ë…€ì˜¨ ê³³ ì²´í¬í•˜ê³  ìƒˆë¡œìš´ ê³³ ë°œê²¬</div></div></div>
        </div>
    </div>
    <button class="intro-cta" onclick="startOnboarding()">ğŸ¯ ë§ì¶¤ ì½”ìŠ¤ ì¶”ì²œë°›ê¸°</button>
    <button class="intro-skip" onclick="startFreeMode()">ğŸ—º ììœ ë¡­ê²Œ ë‘˜ëŸ¬ë³´ê¸°</button>
    <div class="intro-footer">25ê°œ êµ¿ì¦ˆìƒµ Â· ë§ˆì§€ë§‰ í™•ì¸ 2025.01.19</div>
</div>

<div class="onboarding" id="onboarding">
    <div class="ob-header">
        <div class="progress-bar"><div class="progress-fill" id="progressFill"></div></div>
        <button class="skip-btn" onclick="skipOnboarding()">ê±´ë„ˆë›°ê¸°</button>
    </div>
    <div class="ob-content" id="questionContent"></div>
</div>

<div class="result" id="result">
    <div class="result-header">
        <button class="back-btn" onclick="backToOnboarding()">â†</button>
        <h1>ë§ì¶¤ ì¶”ì²œ</h1>
    </div>
    <div class="result-content" id="resultContent"></div>
    <div class="result-footer">
        <button class="start-btn" onclick="startTour()">ğŸš€ íƒë°© ì‹œì‘</button>
        <div class="secondary-btns">
            <button class="sec-btn" onclick="backToOnboarding()">ğŸ”„ ë‹¤ì‹œ</button>
            <button class="sec-btn" onclick="shareCourse()">ğŸ“¤ ê³µìœ </button>
        </div>
    </div>
</div>

<div class="app" id="app">
    <div class="current-dest" id="currentDest"></div>
    <div class="map-container">
        <div id="map"></div>
        <div class="map-status" id="mapStatus"></div>
        <button class="map-btn loc-btn" onclick="goToMyLocation()">ğŸ“</button>
        <div class="next-preview" id="nextPreview"></div>
    </div>
</div>

<div class="app" id="freeApp">
    <div class="free-header">
        <h1>ğŸ—º ì „ì²´ êµ¿ì¦ˆìƒµ</h1>
        <button class="close-btn" onclick="closeFreeMode()">âœ•</button>
    </div>
    <div class="toolbar">
        <div class="filter-row" id="filterRow"></div>
        <div class="stats-row" id="statsRow"></div>
    </div>
    <div class="map-container">
        <div id="freeMap"></div>
        <button class="map-btn loc-btn" onclick="goToMyLocationFree()">ğŸ“</button>
    </div>
</div>

<div class="modal-overlay" id="modal" onclick="closeModal(event)">
    <div class="modal" onclick="event.stopPropagation()">
        <div class="modal-handle"></div>
        <div class="modal-content" id="modalContent"></div>
    </div>
</div>

<div class="complete" id="complete">
    <div class="complete-header">
        <h2>ğŸ‰ íƒë°© ì™„ë£Œ!</h2>
        <p id="completeSubtext"></p>
    </div>
    <div class="complete-content" id="completeContent"></div>
    <div class="complete-footer">
        <button class="complete-btn primary" onclick="viewAllMap()">ğŸ—º ì „ì²´ ì§€ë„</button>
        <button class="complete-btn secondary" onclick="resetApp()">ğŸ”„ ì²˜ìŒìœ¼ë¡œ</button>
    </div>
</div>

<div class="toast" id="toast"></div>

<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDOht0k-HMZ1V2kLPMj3Ho627PGoNgWkAg&callback=initApp&language=ko" async defer></script>
<script src="https://unpkg.com/@googlemaps/markerclusterer/dist/index.min.js"></script>

<script>
const shops = [
    {id:1,name:"ì• ë‹ˆë©”ì´íŠ¸ í™ëŒ€ì ",address:"AKí”Œë¼ì 5ì¸µ",hours:"11:00-21:40",lat:37.55658,lng:126.92366,icon:"ğŸ­",type:"ì¢…í•©",genres:["ì•™ìŠ¤íƒ€","ë¸”ë£¨ë¡","í”¼ê·œì–´","ì—¬ì„±í–¥","ë‚¨ì„±í–¥"]},
    {id:2,name:"ëª¨ì™€ì¦",address:"ì™€ìš°ì‚°ë¡œ21ê¸¸ 28",hours:"12:00-20:00",lat:37.55211,lng:126.92094,icon:"ğŸ’–",type:"ì—¬ì„±í–¥",genres:["ì•™ìŠ¤íƒ€","ë¸”ë£¨ë¡","ì§„ê²©","ì´ì¹˜ë°©ì¿ ì§€"]},
    {id:3,name:"ìµœì• êµ¿ì¦ˆ",address:"ì”ë‹¤ë¦¬ë¡œ 13 B1",hours:"12:00-21:00",lat:37.55330,lng:126.92100,icon:"ğŸ’",type:"ì¤‘ê³ ",genres:["ì•™ìŠ¤íƒ€","ì—¬ì„±í–¥","ì¤‘ê³ "]},
    {id:4,name:"ì‹œë¡œìƒì ",address:"ì™€ìš°ì‚°ë¡œ29ê¸¸ B1",hours:"12:00-21:00",lat:37.55269,lng:126.92152,icon:"âœ¨",type:"ì¢…í•©",genres:["íŠ¸ë Œë“œ","ê°€ì± ","ì—¬ì„±í–¥","ë‚¨ì„±í–¥"]},
    {id:5,name:"ì• ë‹ˆí”ŒëŸ¬ìŠ¤ í•©ì •",address:"ë©”ì„¸ë‚˜í´ë¦¬ìŠ¤ B2",hours:"10:00-22:00",lat:37.54959,lng:126.91352,icon:"ğŸ¢",type:"ì¢…í•©",genres:["í”¼ê·œì–´","ì—¬ì„±í–¥","ë‚¨ì„±í–¥"]},
    {id:6,name:"ì˜¤ëª¨ì°¨ëœë“œ",address:"ì™€ìš°ì‚°ë¡œ29ê¸¸ 46",hours:"12:00-21:00",lat:37.55254,lng:126.92196,icon:"ğŸª",type:"ì¤‘ê³ ",genres:["ì•™ìŠ¤íƒ€","ì¤‘ê³ ","ë„ë¦¬ë²¤"]},
    {id:7,name:"ê¼¬ê¼¬êµ¿ì¦ˆ",address:"ì™€ìš°ì‚°ë¡œ27ê¸¸ 68 3ì¸µ",hours:"13:00-20:30",lat:37.55268,lng:126.92297,icon:"ğŸ",type:"ì¢…í•©",genres:["í•˜ì´í","ì£¼ìˆ íšŒì „","ì í”„"]},
    {id:8,name:"JSìŠ¤í† ì–´",address:"ì”ë‹¤ë¦¬ë¡œ6ê¸¸ 28",hours:"12:00-20:30",lat:37.55393,lng:126.92087,icon:"ğŸ¤–",type:"í”¼ê·œì–´",genres:["ì—ë°˜ê²Œë¦¬ì˜¨","ë‹¨ê°„ë¡ íŒŒ","ì½”ë“œê¸°ì–´ìŠ¤","ê°€ì± "]},
    {id:9,name:"í”¼ê·œì–´í”„ë Œì¦ˆ",address:"ì–‘í™”ë¡œ18ì•ˆê¸¸ 8 B1",hours:"13:00-21:00",lat:37.55392,lng:126.92360,icon:"ğŸ²",type:"í”¼ê·œì–´",genres:["í”¼ê·œì–´","ëœë¤ê¹¡","ì§€ë¥˜"]},
    {id:10,name:"ì•ˆì„œë‹¹",address:"ë™êµë™ 181-6 B1",hours:"12:00-20:00",lat:37.55481,lng:126.92305,icon:"ğŸª",type:"ì¤‘ê³ ",genres:["ìº”ë±ƒì§€","ì§€ë¥˜","ì˜›ë‚ êµ¿ì¦ˆ"]},
    {id:11,name:"í˜¸ì—ë§ˆì¼“",address:"í™ìµë¡œ6ê¸¸ 14",hours:"13:00-19:00",lat:37.55517,lng:126.92455,icon:"ğŸŒ¸",type:"ì†Œí’ˆ",genres:["ì‚°ë¦¬ì˜¤","ì›í™”êµ¿ì¦ˆ","ì í”„ìƒµ"]},
    {id:12,name:"ì• ë‹ˆì„¸ì¹´ì´",address:"ì–´ìš¸ë§ˆë‹¹ë¡œ 155-1",hours:"12:00-21:00",lat:37.55392,lng:126.92262,icon:"ğŸ®",type:"ì¢…í•©",genres:["ë¡œë³´ì½”","ë°ìŠ¤ë…¸íŠ¸","í¡í˜ˆê·€"]},
    {id:13,name:"í—¬ë¡œìŠ¤ë¯¸ì½”",address:"ì™€ìš°ì‚°ë¡œ29ê¸¸ 50",hours:"12:00-20:00",lat:37.55244,lng:126.92213,icon:"ğŸ²",type:"ê°€ì± ",genres:["ê°€ì± ","ì¸í˜•ì˜·"]},
    {id:14,name:"ë”ì¿ ",address:"í™ìµë¡œ6ê¸¸ 38 B1",hours:"12:00-21:00",lat:37.55502,lng:126.92373,icon:"ğŸ",type:"ì¢…í•©",genres:["ë¦¬ë©˜íŠ¸","ì•™ìŠ¤íƒ€","í”„ì„¸ì¹´"]},
    {id:15,name:"ì¼€ì´ë¶ìŠ¤",address:"EXITí™ëŒ€ B1",hours:"12:00-21:00",lat:37.55704,lng:126.92377,icon:"ğŸ“š",type:"ì¤‘ê³ ",genres:["ì¤‘ê³ ","ë™ì¸ì§€","íšŒì§€"]},
    {id:16,name:"ë¸Œë¼ë”êµ¿ì¦ˆ",address:"ì™€ìš°ì‚°ë¡œ 94",hours:"12:00-20:00",lat:37.55403,lng:126.92181,icon:"âš½",type:"ì¢…í•©",genres:["ë¸”ë£¨ë¡","ì£¼ìˆ íšŒì „","ì‚°ë¦¬ì˜¤","ë‹ˆì¼€"]},
    {id:17,name:"í”¼ê·œì–´í”„ë ˆì†Œ FP",address:"ì™€ìš°ì‚°ë¡œ29ê¸¸ 48-11",hours:"12:00-21:00",lat:37.55146,lng:126.92181,icon:"ğŸª",type:"í”¼ê·œì–´",genres:["ì œì¼ë³µê¶Œ","í”¼ê·œì–´"]},
    {id:18,name:"ìŠ¤í˜ì´ìŠ¤ ìš°ë¼ë¼",address:"í™ëŒ€ì…êµ¬ì—­ ì§€í•˜",hours:"12:00-21:00",lat:37.55680,lng:126.92350,icon:"ğŸš‡",type:"ì¢…í•©",genres:["ì´ì¹˜ë°©ì¿ ì§€","ì—ë°˜ê²Œë¦¬ì˜¨"]},
    {id:19,name:"ì›í”¼ê·œì–´",address:"í™ìµë¡œ6ê¸¸ 14 2ì¸µ",hours:"12:00-22:00",lat:37.55530,lng:126.92440,icon:"ğŸ¯",type:"í”¼ê·œì–´",genres:["í”¼ê·œì–´","íŒŒë¼ë¼ì´","ì…ë¬¸"]},
    {id:20,name:"ì˜¤ëª¨ì°¨ëœë“œ 2í˜¸ì ",address:"í™ëŒ€ì…êµ¬ì—­ ì§€í•˜",hours:"12:00-21:00",lat:37.55690,lng:126.92380,icon:"ğŸª",type:"ì¤‘ê³ ",genres:["ì•™ìŠ¤íƒ€","ì—¬ì„±í–¥","ì¤‘ê³ "]},
    {id:21,name:"ë‘ë‹ˆë¶€",address:"ì™€ìš°ì‚°ë¡œ13ê¸¸ 49",hours:"12:00-20:00",lat:37.55147,lng:126.92068,icon:"ğŸ¸",type:"ì¢…í•©",genres:["ì¼€ì´ì˜¨","ë§ˆë§ˆë§ˆ","ê³ ì „"]},
    {id:22,name:"ì•„ì´ë…¸ëª¨ë…¸",address:"ì”ë‹¤ë¦¬ë¡œ6ê¸¸ 36",hours:"12:00-21:00",lat:37.55430,lng:126.92150,icon:"ğŸ’«",type:"ì†Œí’ˆ",genres:["ìºìºì²´","ê±¸ë°´í¬","í¬ê·€ì¥ë¥´"]},
    {id:23,name:"ì• ë‹ˆí”Œë¼ì",address:"ì™€ìš°ì‚°ë¡œ29ê¸¸ 42",hours:"11:00-21:00",lat:37.55264,lng:126.92203,icon:"ğŸ«",type:"ë‚¨ì„±í–¥",genres:["ì œì¼ë³µê¶Œ","ë‚¨ì„±í–¥","í”¼ê·œì–´"]},
    {id:24,name:"í”¼ê·œì–´í”„ë ˆì†Œ í™ëŒ€",address:"ì”ë‹¤ë¦¬ë¡œ6ê¸¸ 25",hours:"12:00-21:00",lat:37.55352,lng:126.92247,icon:"ğŸ°",type:"í”¼ê·œì–´",genres:["ì œì¼ë³µê¶Œ","í”¼ê·œì–´"]},
    {id:25,name:"ë¼ì‹ ë°˜",address:"AKí”Œë¼ì",hours:"12:00-20:00",lat:37.55658,lng:126.92366,icon:"ğŸ“–",type:"ì¤‘ê³ ",genres:["í¬ì¹´","íšŒì§€","ìº”ë±ƒì§€"]}
];

const filterTypes = [{key:'all',label:'ì „ì²´'},{key:'ì¢…í•©',label:'ì¢…í•©'},{key:'ì—¬ì„±í–¥',label:'ì—¬ì„±í–¥'},{key:'í”¼ê·œì–´',label:'í”¼ê·œì–´'},{key:'ì¤‘ê³ ',label:'ì¤‘ê³ '},{key:'open',label:'ì˜ì—…ì¤‘'}];
const questions = [
    {text:"ì–´ë–¤ êµ¿ì¦ˆë¥¼ ì£¼ë¡œ ì°¾ì•„?",options:[{icon:"ğŸ¤–",main:"í”¼ê·œì–´ / ë³µê¶Œ",sub:"ì œì¼ë³µê¶Œ, ë„¨ë„ë¡œì´ë“œ",value:"figure"},{icon:"ğŸ’–",main:"ì—¬ì„±í–¥",sub:"ì•™ìŠ¤íƒ€, ë¸”ë£¨ë¡, í•˜ì´í",value:"female"},{icon:"ğŸ”¥",main:"ë‚¨ì„±í–¥",sub:"ì—ë°˜ê²Œë¦¬ì˜¨, í”¼ê·œì–´",value:"male"},{icon:"ğŸŒŸ",main:"ë‹¤ ì¢‹ì•„!",sub:"ê³¨ê³ ë£¨ êµ¬ê²½í• ë˜",value:"all"}]},
    {text:"êµ¿ì¦ˆìƒµ ê²½í—˜ì€?",options:[{icon:"ğŸ£",main:"ì²˜ìŒì´ì•¼",sub:"ê¸°ë³¸ë¶€í„°",value:"beginner"},{icon:"ğŸ¥",main:"ëª‡ ë²ˆ ì™€ë´¤ì–´",sub:"ì–´ëŠ ì •ë„ ì•Œì•„",value:"intermediate"},{icon:"ğŸ¦…",main:"ë‹¨ê³¨ì´ì§€",sub:"ìˆ¨ì€ ë§›ì§‘",value:"expert"}]}
];

let map,freeMap,userLocation=null,userMarker=null,freeUserMarker=null,markerCluster=null;
let currentQuestion=0,answers={},recommendedShops=[],currentIndex=0,sessionVisited=new Set(),tourMode=false,isDarkMode=true,currentFilter='all';
const STORAGE_KEY='hongdae_goods_v5';
let savedData=JSON.parse(localStorage.getItem(STORAGE_KEY)||'{"visitedShops":[],"totalVisits":0,"reviews":{}}');

function toggleTheme(){isDarkMode=!isDarkMode;document.body.classList.toggle('light-mode',!isDarkMode);document.getElementById('globalTheme').textContent=isDarkMode?'ğŸŒ™':'â˜€ï¸';if(map)updateMapStyle(map);if(freeMap)updateMapStyle(freeMap);}
function updateMapStyle(m){const dark=[{elementType:"geometry",stylers:[{color:"#1d1d1f"}]},{elementType:"labels.text.fill",stylers:[{color:"#8e8e93"}]},{featureType:"road",elementType:"geometry",stylers:[{color:"#2c2c2e"}]},{featureType:"poi",stylers:[{visibility:"off"}]},{featureType:"water",stylers:[{color:"#0e0e0e"}]}];m.setOptions({styles:isDarkMode?dark:[{featureType:"poi",stylers:[{visibility:"off"}]}]});}
function calcDist(lat1,lng1,lat2,lng2){const R=6371000,dLat=(lat2-lat1)*Math.PI/180,dLng=(lng2-lng1)*Math.PI/180,a=Math.sin(dLat/2)**2+Math.cos(lat1*Math.PI/180)*Math.cos(lat2*Math.PI/180)*Math.sin(dLng/2)**2;return R*2*Math.atan2(Math.sqrt(a),Math.sqrt(1-a));}
function formatDist(m){return m<1000?Math.round(m)+'m':(m/1000).toFixed(1)+'km';}
function formatWalk(m){return Math.max(1,Math.round(m/67))+'ë¶„';}
function updateDistances(){if(!userLocation)return;shops.forEach(s=>{s.dist=calcDist(userLocation.lat,userLocation.lng,s.lat,s.lng);s.distText=formatDist(s.dist);s.walkTime=formatWalk(s.dist);});}
function getShopStatus(shop){const now=new Date(),mins=now.getHours()*60+now.getMinutes(),[open,close]=shop.hours.split('-'),[oh,om]=open.split(':').map(Number),[ch,cm]=close.split(':').map(Number),openMins=oh*60+om,closeMins=ch*60+cm;if(mins<openMins){const diff=openMins-mins;return diff<=60?{status:'soon',text:`${diff}ë¶„ í›„ ì˜¤í”ˆ`,isOpen:false}:{status:'closed',text:'ì˜ì—… ì „',isOpen:false};}if(mins>=closeMins)return{status:'closed',text:'ì˜ì—… ì¢…ë£Œ',isOpen:false};const remaining=closeMins-mins;return remaining<=60?{status:'open',text:`${remaining}ë¶„ í›„ ë§ˆê°`,isOpen:true}:{status:'open',text:'ì˜ì—…ì¤‘',isOpen:true};}
function isVisited(id){return savedData.visitedShops.includes(id);}
function markVisited(id){if(!savedData.visitedShops.includes(id)){savedData.visitedShops.push(id);saveData();}sessionVisited.add(id);}
function unmarkVisitedPermanent(id){savedData.visitedShops=savedData.visitedShops.filter(i=>i!==id);saveData();}
function unmarkVisited(id){sessionVisited.delete(id);}
function showToast(msg){const t=document.getElementById('toast');t.textContent=msg;t.classList.add('show');setTimeout(()=>t.classList.remove('show'),2000);}
function saveData(){localStorage.setItem(STORAGE_KEY,JSON.stringify(savedData));}
function getReviews(id){return savedData.reviews[id]||[];}
function addReview(id,text){if(!savedData.reviews[id])savedData.reviews[id]=[];savedData.reviews[id].unshift({text,date:new Date().toLocaleDateString('ko-KR')});if(savedData.reviews[id].length>10)savedData.reviews[id].pop();saveData();}
function getFilteredShops(){return shops.filter(s=>{if(currentFilter==='all')return true;if(currentFilter==='open')return getShopStatus(s).isOpen;return s.type===currentFilter||s.genres.includes(currentFilter);});}

function startOnboarding(){document.getElementById('intro').classList.add('hide');document.getElementById('onboarding').classList.add('show');currentQuestion=0;renderQuestion();}
function startFreeMode(){document.getElementById('intro').classList.add('hide');document.getElementById('freeApp').classList.add('show');document.getElementById('globalTheme').classList.add('hide');renderFilterRow();updateFreeStats();setTimeout(()=>{initFreeMap();setTimeout(()=>{if(freeMap){google.maps.event.trigger(freeMap,'resize');freeMap.setCenter({lat:37.554,lng:126.922});freeMap.setZoom(17);}},200);},100);}
function closeFreeMode(){document.getElementById('freeApp').classList.remove('show');document.getElementById('intro').classList.remove('hide');document.getElementById('globalTheme').classList.remove('hide');}
function renderFilterRow(){document.getElementById('filterRow').innerHTML=filterTypes.map(f=>`<button class="filter-chip ${currentFilter===f.key?'active':''}" onclick="setFilter('${f.key}')">${f.label}</button>`).join('');}
function setFilter(key){currentFilter=key;renderFilterRow();updateFreeStats();updateFreeMap();}
function updateFreeStats(){const filtered=getFilteredShops(),visited=filtered.filter(s=>isVisited(s.id)).length,open=filtered.filter(s=>getShopStatus(s).isOpen).length;document.getElementById('statsRow').innerHTML=`<span>í‘œì‹œ <strong>${filtered.length}</strong>ê³³</span><span>ì˜ì—…ì¤‘ <strong>${open}</strong>ê³³</span><span>ë°©ë¬¸ <strong>${visited}</strong>ê³³</span>`;}
function renderQuestion(){const q=questions[currentQuestion];document.getElementById('progressFill').style.width=((currentQuestion+1)/questions.length*100)+'%';document.getElementById('questionContent').innerHTML=`<div class="q-num">ì§ˆë¬¸ ${currentQuestion+1}/${questions.length}</div><div class="q-text">${q.text}</div><div class="options">${q.options.map((o,i)=>`<button class="opt-btn" onclick="selectOption(${i},'${o.value}')"><div class="opt-icon">${o.icon}</div><div class="opt-text"><span class="main">${o.main}</span><span class="sub">${o.sub}</span></div></button>`).join('')}</div>`;}
function selectOption(idx,value){document.querySelectorAll('.opt-btn').forEach((b,i)=>b.classList.toggle('sel',i===idx));answers[currentQuestion]=value;setTimeout(()=>{if(currentQuestion<questions.length-1){currentQuestion++;renderQuestion();}else generateRecommendation();},300);}
function skipOnboarding(){answers={0:'all',1:'beginner'};generateRecommendation();}
function backToOnboarding(){document.getElementById('result').classList.remove('show');document.getElementById('onboarding').classList.add('show');currentQuestion=0;renderQuestion();}

function generateRecommendation(){document.getElementById('onboarding').classList.remove('show');const genre=answers[0]||'all',level=answers[1]||'beginner';let title='',desc='',reasons=[],filtered=[];const unvisited=shops.filter(s=>!isVisited(s.id));if(genre==='figure'){title='ğŸ¤– í”¼ê·œì–´ í—Œí„° ì½”ìŠ¤';desc='í”¼ê·œì–´ì™€ ë³µê¶Œ ì°¾ëŠ” ë‹¹ì‹ ì„ ìœ„í•œ ì½”ìŠ¤';filtered=unvisited.filter(s=>s.genres.some(g=>['í”¼ê·œì–´','ì œì¼ë³µê¶Œ','ì—ë°˜ê²Œë¦¬ì˜¨','ê°€ì± '].includes(g)));reasons=['ì œì¼ë³µê¶Œ ìˆëŠ” ê³³ ìœ„ì£¼','í”¼ê·œì–´ ì¢…ë¥˜ ë§ì€ ë§¤ì¥'];}else if(genre==='female'){title='ğŸ’– ì—¬ì„±í–¥ ì„±ì§€ìˆœë¡€';desc='ì•™ìŠ¤íƒ€, ë¸”ë£¨ë¡, í•˜ì´í ë•í›„ ì½”ìŠ¤';filtered=unvisited.filter(s=>s.genres.some(g=>['ì•™ìŠ¤íƒ€','ë¸”ë£¨ë¡','í•˜ì´í','ì—¬ì„±í–¥','ì£¼ìˆ íšŒì „'].includes(g)));reasons=['ì•™ìŠ¤íƒ€/ë¸”ë£¨ë¡ ë§ì€ ê³³','ì´ì¹˜ë°©ì¿ ì§€ ê°€ëŠ¥'];}else if(genre==='male'){title='ğŸ”¥ ë‚¨ì„±í–¥ í’€ì½”ìŠ¤';desc='ë‚¨ì„±í–¥ êµ¿ì¦ˆì™€ í”¼ê·œì–´ ì½”ìŠ¤';filtered=unvisited.filter(s=>s.genres.some(g=>['ë‚¨ì„±í–¥','ì—ë°˜ê²Œë¦¬ì˜¨','ì œì¼ë³µê¶Œ'].includes(g)));reasons=['ë‚¨ì„±í–¥ íŠ¹í™” ë§¤ì¥','ì œì¼ë³µê¶Œ ë‹¤ì–‘'];}else{title='ğŸŒŸ í™ëŒ€ êµ¿ì¦ˆìƒµ íˆ¬ì–´';desc='ë‹¤ì–‘í•œ ì¥ë¥´ ê³¨ê³ ë£¨ ì¦ê¸°ëŠ” ì½”ìŠ¤';filtered=unvisited.filter(s=>s.type==='ì¢…í•©');reasons=['ì¢…í•© ë§¤ì¥ ìœ„ì£¼','ê·œëª¨ í° ê³³ ìš°ì„ '];}if(level==='expert'){filtered=[...filtered,...unvisited.filter(s=>s.type==='ì¤‘ê³ ')];reasons.push('ìˆ¨ì€ ë§›ì§‘ í¬í•¨');}if(savedData.visitedShops.length>0)reasons.push('ì´ë¯¸ ê°„ ê³³ ì œì™¸');reasons.push('ì˜ì—…ì¤‘ì¸ ê³³ ìš°ì„ ');if(filtered.length<5)filtered=[...filtered,...unvisited.filter(s=>!filtered.includes(s))];filtered.sort((a,b)=>{const aOpen=getShopStatus(a).isOpen?0:1,bOpen=getShopStatus(b).isOpen?0:1;if(aOpen!==bOpen)return aOpen-bOpen;return(a.dist||0)-(b.dist||0);});recommendedShops=filtered.slice(0,5);document.getElementById('resultContent').innerHTML=`<div class="ai-card"><div class="ai-badge">âœ¨ AI ë§ì¶¤ ì¶”ì²œ</div><div class="ai-title">${title}</div><div class="ai-desc">${desc}</div><div class="ai-reasons"><div class="ai-reasons-title">ì´ë ‡ê²Œ ì¶”ì²œí•œ ì´ìœ </div>${reasons.map(r=>`<div class="reason"><div class="reason-icon">âœ“</div><span>${r}</span></div>`).join('')}</div></div><div class="section-title"><span>ì¶”ì²œ ìˆœì„œ</span><span class="shop-count">${recommendedShops.length}ê³³</span></div>${recommendedShops.map((shop,i)=>{const st=getShopStatus(shop);return`<div class="shop-card ${i===0?'first':''}" onclick="openModal(${shop.id})"><div class="shop-photo">${shop.icon}<div class="shop-status ${st.status}">${st.text}</div><div class="shop-rank">${i+1}</div></div><div class="shop-body"><div class="shop-name-row"><span class="shop-name">${shop.name}</span><span class="shop-type">${shop.type}</span></div><div class="shop-meta"><span>ğŸ“ ${shop.address}</span><span>ğŸ• ${shop.hours}</span>${shop.walkTime?`<span>ğŸš¶ ${shop.walkTime}</span>`:''}</div><div class="shop-genres">${shop.genres.slice(0,3).map(g=>`<span class="genre-tag">#${g}</span>`).join('')}</div></div></div>`;}).join('')}`;document.getElementById('result').classList.add('show');}

function startTour(){tourMode=true;currentIndex=0;sessionVisited.clear();document.getElementById('result').classList.remove('show');document.getElementById('app').classList.add('show');document.getElementById('globalTheme').classList.add('hide');setTimeout(()=>{if(map)google.maps.event.trigger(map,'resize');updateCurrentDest();updateMap();},100);}
function updateCurrentDest(){const shop=recommendedShops[currentIndex],next=recommendedShops[currentIndex+1],st=getShopStatus(shop),isCurrentVisited=sessionVisited.has(shop.id);document.getElementById('currentDest').innerHTML=`<div class="dest-label"><span class="live-dot"></span><span>${currentIndex+1}/${recommendedShops.length}</span><div class="stamps">${recommendedShops.map((s,i)=>`<div class="stamp ${sessionVisited.has(s.id)?'done':i===currentIndex?'current':''}">${sessionVisited.has(s.id)?'âœ“':i+1}</div>`).join('')}</div></div><div class="dest-shop"><div class="dest-photo">${shop.icon}</div><div class="dest-info"><h2>${shop.name}</h2><p>${shop.address}</p></div><div class="dest-walk">${shop.walkTime||'-'}</div></div><div class="dest-status-bar"><span class="status ${st.status}">${st.text}</span><span class="hours">ğŸ• ${shop.hours}</span></div><div class="dest-genres">${shop.genres.slice(0,4).map(g=>`<span class="genre-tag">#${g}</span>`).join('')}</div><div class="dest-actions">${isCurrentVisited?`<button class="action-btn danger" onclick="undoComplete()">â†© ì·¨ì†Œ</button><button class="action-btn primary" onclick="nextShop()">ë‹¤ìŒ â†’</button>`:`<button class="action-btn secondary" onclick="openModal(${shop.id})">ìƒì„¸</button><button class="action-btn success" onclick="completeShop()">âœ“ ë„ì°©</button>`}</div>`;document.getElementById('mapStatus').innerHTML=`<div class="map-status-icon">${shop.icon}</div><div class="map-status-text"><div class="title">${shop.name}</div><div class="sub">${shop.distText||'-'}</div></div><span class="map-status-badge ${st.status}">${st.text}</span>`;if(next){document.getElementById('nextPreview').innerHTML=`<div class="next-icon">${next.icon}</div><div class="next-info"><div class="label">ë‹¤ìŒ</div><h4>${next.name}</h4></div><div class="next-walk">â†’ ${formatWalk(calcDist(shop.lat,shop.lng,next.lat,next.lng))}</div>`;document.getElementById('nextPreview').style.display='flex';}else{document.getElementById('nextPreview').innerHTML=`<div class="next-info" style="width:100%;text-align:center"><div class="label">ğŸ‰ ë§ˆì§€ë§‰!</div></div>`;}}
function completeShop(){markVisited(recommendedShops[currentIndex].id);showToast(`âœ“ ${recommendedShops[currentIndex].name} ì™„ë£Œ!`);updateCurrentDest();updateMap();if(recommendedShops.every(s=>sessionVisited.has(s.id)))setTimeout(()=>showComplete(),500);}
function undoComplete(){unmarkVisited(recommendedShops[currentIndex].id);showToast(`â†© ì·¨ì†Œë¨`);updateCurrentDest();updateMap();}
function nextShop(){if(currentIndex<recommendedShops.length-1){currentIndex++;updateCurrentDest();updateMap();}else showComplete();}
function showComplete(){const visitedList=recommendedShops.filter(s=>sessionVisited.has(s.id));savedData.totalVisits++;saveData();document.getElementById('completeSubtext').textContent=`${visitedList.length}ê³³ ë°©ë¬¸ ì™„ë£Œ`;document.getElementById('completeContent').innerHTML=visitedList.map(shop=>`<div class="complete-card"><div class="complete-icon">${shop.icon}</div><div class="complete-info"><h3>${shop.name}</h3><p>${shop.address}</p></div></div>`).join('');document.getElementById('app').classList.remove('show');document.getElementById('complete').classList.add('show');}
function viewAllMap(){document.getElementById('complete').classList.remove('show');document.getElementById('freeApp').classList.add('show');renderFilterRow();updateFreeStats();setTimeout(()=>{initFreeMap();setTimeout(()=>{if(freeMap){google.maps.event.trigger(freeMap,'resize');freeMap.setCenter({lat:37.554,lng:126.922});freeMap.setZoom(17);}},200);},100);}

const darkMapStyles=[{elementType:"geometry",stylers:[{color:"#1d1d1f"}]},{elementType:"labels.text.fill",stylers:[{color:"#8e8e93"}]},{featureType:"road",elementType:"geometry",stylers:[{color:"#2c2c2e"}]},{featureType:"poi",stylers:[{visibility:"off"}]},{featureType:"water",stylers:[{color:"#0e0e0e"}]}];
function initApp(){map=new google.maps.Map(document.getElementById('map'),{center:{lat:37.554,lng:126.922},zoom:17,disableDefaultUI:true,zoomControl:true,gestureHandling:'greedy',styles:darkMapStyles});startTracking();}
function initFreeMap(){const mapDiv=document.getElementById('freeMap');if(!mapDiv)return;if(freeMap){updateFreeMap();return;}freeMap=new google.maps.Map(mapDiv,{center:{lat:37.554,lng:126.922},zoom:17,disableDefaultUI:true,zoomControl:true,gestureHandling:'greedy',styles:isDarkMode?darkMapStyles:[{featureType:"poi",stylers:[{visibility:"off"}]}]});google.maps.event.addListenerOnce(freeMap,'idle',()=>updateFreeMap());}
function updateFreeMap(){if(!freeMap)return;if(markerCluster){markerCluster.clearMarkers();markerCluster=null;}if(window.freeMarkers)window.freeMarkers.forEach(m=>m.setMap(null));window.freeMarkers=[];const filtered=getFilteredShops(),markers=[];filtered.forEach(shop=>{const visited=isVisited(shop.id),st=getShopStatus(shop);const marker=new google.maps.Marker({position:{lat:shop.lat,lng:shop.lng},icon:{url:`data:image/svg+xml,${encodeURIComponent(`<svg width="36" height="44" xmlns="http://www.w3.org/2000/svg"><circle cx="18" cy="18" r="16" fill="${visited?'#30d158':st.isOpen?'#007aff':'#666'}" stroke="#fff" stroke-width="2"/><text x="18" y="24" font-size="14" text-anchor="middle" fill="white">${visited?'âœ“':shop.icon}</text></svg>`)}`,scaledSize:new google.maps.Size(36,44),anchor:new google.maps.Point(18,22)}});marker.addListener('click',()=>openModal(shop.id));markers.push(marker);window.freeMarkers.push(marker);});if(typeof markerClusterer!=='undefined'){markerCluster=new markerClusterer.MarkerClusterer({map:freeMap,markers:markers,renderer:{render:({count,position})=>new google.maps.Marker({position,icon:{url:`data:image/svg+xml,${encodeURIComponent(`<svg width="44" height="44" xmlns="http://www.w3.org/2000/svg"><circle cx="22" cy="22" r="20" fill="#007aff" stroke="#fff" stroke-width="2"/><text x="22" y="28" font-size="16" font-weight="bold" text-anchor="middle" fill="white">${count}</text></svg>`)}`,scaledSize:new google.maps.Size(44,44),anchor:new google.maps.Point(22,22)},zIndex:1000+count})}});}else{markers.forEach(m=>m.setMap(freeMap));}if(userLocation){if(!freeUserMarker){freeUserMarker=new google.maps.Marker({position:userLocation,map:freeMap,icon:{path:google.maps.SymbolPath.CIRCLE,scale:8,fillColor:'#007aff',fillOpacity:1,strokeColor:'#fff',strokeWeight:2},zIndex:2000});}else{freeUserMarker.setMap(freeMap);freeUserMarker.setPosition(userLocation);}}}
function startTracking(){if(!navigator.geolocation)return;navigator.geolocation.watchPosition(pos=>{userLocation={lat:pos.coords.latitude,lng:pos.coords.longitude};updateDistances();if(map&&!userMarker){userMarker=new google.maps.Marker({position:userLocation,map,icon:{path:google.maps.SymbolPath.CIRCLE,scale:8,fillColor:'#007aff',fillOpacity:1,strokeColor:'#fff',strokeWeight:2},zIndex:2000});}else if(userMarker)userMarker.setPosition(userLocation);if(freeUserMarker)freeUserMarker.setPosition(userLocation);if(tourMode)updateCurrentDest();},()=>{},{enableHighAccuracy:true,timeout:15000,maximumAge:0});}
function updateMap(){if(!map)return;if(window.shopMarkers)window.shopMarkers.forEach(m=>m.setMap(null));if(window.routeLine)window.routeLine.setMap(null);window.shopMarkers=[];const bounds=new google.maps.LatLngBounds();if(userLocation)bounds.extend(userLocation);const pathCoords=userLocation?[userLocation]:[];recommendedShops.forEach((shop,idx)=>{const isCurrent=idx===currentIndex,isDone=sessionVisited.has(shop.id);const marker=new google.maps.Marker({position:{lat:shop.lat,lng:shop.lng},map,icon:{url:`data:image/svg+xml,${encodeURIComponent(`<svg width="44" height="52" xmlns="http://www.w3.org/2000/svg"><circle cx="22" cy="22" r="20" fill="${isDone?'#30d158':isCurrent?'#007aff':'#444'}" stroke="white" stroke-width="2"/><text x="22" y="28" font-size="18" text-anchor="middle" fill="white">${isDone?'âœ“':shop.icon}</text></svg>`)}`,scaledSize:new google.maps.Size(44,52),anchor:new google.maps.Point(22,26)},zIndex:isCurrent?500:100});marker.addListener('click',()=>openModal(shop.id));window.shopMarkers.push(marker);bounds.extend({lat:shop.lat,lng:shop.lng});pathCoords.push({lat:shop.lat,lng:shop.lng});});window.routeLine=new google.maps.Polyline({path:pathCoords,geodesic:true,strokeColor:'#007aff',strokeOpacity:0,icons:[{icon:{path:'M 0,-1 0,1',strokeOpacity:0.5,scale:2},offset:'0',repeat:'12px'}]});window.routeLine.setMap(map);map.fitBounds(bounds,60);}
function goToMyLocation(){if(userLocation&&map){map.panTo(userLocation);map.setZoom(17);}}
function goToMyLocationFree(){if(userLocation&&freeMap){freeMap.panTo(userLocation);freeMap.setZoom(17);}}

function openModal(shopId){const shop=shops.find(s=>s.id===shopId);if(!shop)return;const st=getShopStatus(shop),visited=isVisited(shop.id),reviews=getReviews(shop.id);document.getElementById('modalContent').innerHTML=`<div class="modal-photo">${shop.icon}<span class="modal-status ${st.status}">${st.text}</span></div><div class="modal-title-row"><span class="modal-title">${shop.name}</span>${visited?'<span class="genre-tag" style="background:var(--success);color:#fff;">âœ“ ë°©ë¬¸í•¨</span>':''}</div><div class="modal-meta"><span>ğŸ“ ${shop.address}</span>${shop.walkTime?`<span>ğŸš¶ ${shop.walkTime}</span>`:''}<span>ğŸ· ${shop.type}</span></div><div class="modal-genres">${shop.genres.map(g=>`<span class="genre-tag">#${g}</span>`).join('')}</div><div class="modal-info"><div class="modal-info-row"><span class="icon">ğŸ•</span>${shop.hours}</div>${shop.distText?`<div class="modal-info-row"><span class="icon">ğŸ“</span>${shop.distText}</div>`:''}</div><div class="review-section"><div class="review-title">ğŸ’¬ í•œì¤„í‰</div><div class="review-input-wrap"><input type="text" class="review-input" id="reviewInput" placeholder="í•œì¤„í‰ì„ ë‚¨ê²¨ë³´ì„¸ìš”" maxlength="50"><button class="review-submit" onclick="submitReview(${shop.id})">ë“±ë¡</button></div><div class="review-list">${reviews.length>0?reviews.map(r=>`<div class="review-item">${r.text}<div class="date">${r.date}</div></div>`).join(''):'<div style="color:var(--text-sub);font-size:12px;">ì•„ì§ í•œì¤„í‰ì´ ì—†ì–´ìš”</div>'}</div></div><div class="modal-actions"><button class="modal-btn secondary" onclick="closeModal()">ë‹«ê¸°</button>${visited?`<button class="modal-btn danger" onclick="unmarkVisitedFromModal(${shop.id})">ë°©ë¬¸ ì·¨ì†Œ</button>`:`<button class="modal-btn success" onclick="markVisitedFromModal(${shop.id})">âœ“ ë°©ë¬¸ ì™„ë£Œ</button>`}</div>`;document.getElementById('modal').classList.add('show');}
function submitReview(shopId){const input=document.getElementById('reviewInput'),text=input.value.trim();if(!text)return;addReview(shopId,text);showToast('ğŸ’¬ ë“±ë¡ë¨');openModal(shopId);}
function markVisitedFromModal(shopId){markVisited(shopId);showToast('âœ“ ë°©ë¬¸ ì™„ë£Œ');closeModal();if(freeMap){updateFreeMap();updateFreeStats();}}
function unmarkVisitedFromModal(shopId){unmarkVisitedPermanent(shopId);showToast('â†© ì‚­ì œë¨');closeModal();if(freeMap){updateFreeMap();updateFreeStats();}}
function closeModal(e){if(e&&e.target.id!=='modal')return;document.getElementById('modal').classList.remove('show');}
function shareCourse(){const totalWalk=recommendedShops.reduce((sum,s)=>sum+(s.dist||0),0);const text=`ğŸ­ í™ëŒ€ êµ¿ì¦ˆìƒµ ì¶”ì²œ\n\n${recommendedShops.map((s,i)=>`${i+1}. ${s.name}`).join('\n')}\n\nì´ ë„ë³´ ì•½ ${formatWalk(totalWalk)}\n\nhttps://wonjong0304-oss.github.io/hongdae-goods/`;if(navigator.share)navigator.share({title:'í™ëŒ€ êµ¿ì¦ˆìƒµ',text});else{navigator.clipboard.writeText(text);showToast('ğŸ“‹ ë³µì‚¬ë¨!');}}
function resetApp(){location.reload();}
</script>
</body>
</html>
